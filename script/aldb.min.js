var EFaction={UNIVERSAL:1,SAKURA:2,EAGLE:4,ROYAL:8,IRONBLOOD:16,EASTERN_RAD:32,NORTH_UNION:64,IRIS:128,VICHYA:256,BILIBILI:512,NEPTUNIA:1024,UNKNOWN1:65536,SIREN:131072,props:{1:{name:"Universal",value:1,code:"UNIV"},2:{name:"Sakura Empire",value:2,code:"IJN"},4:{name:"Eagle Union",value:4,code:"USS"},8:{name:"Royal Navy",value:8,code:"HMS"},16:{name:"Ironblood",value:16,code:"KMS"},32:{name:"Eastern Radiance",value:32,code:"ROC"},64:{name:"North Union",value:64,code:"SN"},128:{name:"Iris Libre",value:128,code:"FFNF"},256:{name:"Vichya Dominion",value:256,code:"MNF"},512:{name:"Bilibili",value:512,code:"BIL"},1024:{name:"Neptunia",value:1024,code:"HDN"},65536:{name:"Unknown1",value:65536,code:"UNKN1"},131072:{name:"Sirens",value:131072,code:"SIREN"}}},EClass={CARRIER:1,LIGHT_CARRIER:2,BATTLESHIP:4,BATTLECRUISER:8,AVIATION_BATTLESHIP:16,MONITOR:32,REPAIR_SHIP:64,DESTROYER:128,LIGHT_CRUISER:256,HEAVY_CRUISER:512,SUBMARINE:1024,UNKNOWN1:2048,UNKNOWN2:4096,UNKNOWN3:8192,UNKNOWN4:16384,SUICIDE_BOAT:32768,BACKLINE:127,FRONTLINE:896,CARRIER_CLASS:19,props:{1:{name:"Aircraft Carrier",value:1,code:"CV"},2:{name:"Light Aircraft Carrier",value:2,code:"CVL"},4:{name:"Battleship",value:4,code:"BB"},8:{name:"Battlecruiser",value:8,code:"BC"},16:{name:"Aviation Battleship",value:16,code:"BBV"},32:{name:"Monitor",value:32,code:""},64:{name:"Repair Ship",value:64,code:"AR"},128:{name:"Destroyer",value:128,code:"DD"},256:{name:"Light Cruiser",value:256,code:"CL"},512:{name:"Heavy Cruiser",value:512,code:"CA"},1024:{name:"Submarine",value:1024,code:"SS"},2048:{name:"Unknown1",value:2048,code:"UNK1"},4096:{name:"Unknown2",value:4096,code:"UNK2"},8192:{name:"Unknown3",value:8192,code:"UNK3"},16384:{name:"Unknown4",value:16384,code:"UNK4"},32768:{name:"Suicide Boat",value:32768,code:"SB"},127:{name:"Backline",value:127,code:"Back"},896:{name:"Frontline",value:896,code:"Front"},19:{name:"Carrier Class",value:19,code:"Carrier"}}},ERarity={NORMAL:1,RARE:2,ELITE:4,SUPER_RARE:8,ULTRA_RARE:16,PRIORITY:32,props:{1:{name:"Normal",value:1,code:"N"},2:{name:"Rare",value:2,code:"R"},4:{name:"Elite",value:4,code:"SR"},8:{name:"Super Rare",value:8,code:"SR"},16:{name:"Ultra Rare",value:16,code:"UR"},32:{name:"Priority",value:32,code:"PR"}}},EGunType={DD_GUN:1,CL_GUN:2,CA_GUN:4,BB_GUN:8,TORP:16,SUB_TORP:32,FIGHTER:64,DIVE_BOMBER:128,TORP_BOMBER:256,ANTIAIR_GUN:512,AUX_EQ:1024,ASW_EQ:2048,SPECIAL:4096,DEUTS:8192,ASW_PLANES:16384,AIRCRAFT:448,props:{1:{name:"Destroyer Gun",value:1,code:"DD Gun"},2:{name:"Light Cruiser Gun",value:2,code:"CL Gun"},4:{name:"Heavy Cruiser Gun",value:4,code:"CA Gun"},8:{name:"Battleship Gun",value:8,code:"BB Gun"},16:{name:"Torpedoes",value:16,code:"Torp"},32:{name:"Sub Torpedoes",value:32,code:"Sub Torp"},64:{name:"Fighter",value:64,code:"Fighter"},128:{name:"Dive Bomber",value:128,code:"Dive Bomber"},256:{name:"Torp Bomber",value:256,code:"Torp Bomber"},512:{name:"Anti-air Gun",value:512,code:"AA Gun"},1024:{name:"Auxiliary",value:1024,code:"Aux"},2048:{name:"Anti-sub Equipment",value:2048,code:"ASW Eq"},4096:{name:"Special",value:4096,code:"Special"},8192:{name:"Deuts",value:8192,code:"Deuts"},16384:{name:"ASW Planes",value:16384,code:"ASWP"},3:{name:"DD/CL Gun",value:3,code:"DD/CL Gun"},448:{name:"Aircraft",value:448,code:"Aircraft"}}},EArmorType={LIGHT:1,MEDIUM:2,HEAVY:4,props:{1:{name:"Light Armor",value:1,code:"Light"},2:{name:"Medium Armor",value:2,code:"Medium"},4:{name:"Heavy Armor",value:4,code:"Heavy"}}},EAmmoType={NORMAL:1,NORMAL_PLUS:2,HE:4,HE_PLUS:8,AP:16,AP_PLUS:32,MAGNETIC:64,SANSHIKI_SHELL:128,SANSHIKI_FRAGS:256,props:{1:{name:"Normal",value:1,code:"Normal"},2:{name:"Normal+",value:2,code:"Normal+"},4:{name:"Explosive",value:4,code:"HE"},8:{name:"Explosive+",value:8,code:"HE+"},16:{name:"Armor Penetration",value:16,code:"AP"},32:{name:"Armor Penetration+",value:32,code:"AP+"},64:{name:"Magnetic",value:16,code:"MAG"},128:{name:"Sanshiki Shell",value:16,code:"SSShell"},256:{name:"Sanshiki Fragment",value:16,code:"SSFrag"}}};DGAttrToIdx={HP:0,FP:1,Torp:2,AA:3,AirPower:4,Rel:5,Armor:6,Acc:7,Eva:8,Speed:9,Luck:10,AntiSub:11};var EAttributes={DURABILITY:0,CANNON:1,TORP:2,AA:3,AIR:4,RELOAD:5,ARMOR:6,HIT:7,EVA:8,SPEED:9,LUCK:10,ANTISUB:11,props:{0:{name:"Durability",value:0,code:"HP"},1:{name:"Firepower",value:1,code:"FP"},2:{name:"Torp",value:2,code:"TORP"},3:{name:"Anti-Air",value:3,code:"AA"},4:{name:"Airpower",value:4,code:"AP"},5:{name:"Reload",value:5,code:"REL"},6:{name:"Armor",value:6,code:"ARMOR"},7:{name:"Hit",value:7,code:"HIT"},8:{name:"Evasion",value:8,code:"EVA"},9:{name:"Speed",value:9,code:"SPD"},10:{name:"Luck",value:10,code:"LUCK"},11:{name:"Antisub",value:11,code:"ASW"}}},DGearScore={1:{base:30,bonus:5},2:{base:50,bonus:8},3:{base:80,bonus:10},4:{base:120,bonus:12},5:{base:180,bonus:15},6:{base:300,bonus:20}},DArmorMods={1:{1:{1:1,2:0.5,4:0.2},2:{1:1,2:0.6,4:0.2},4:{1:1.2,2:0.6,4:0.6},10:{1:0.9,2:0.7,4:0.4}},2:{1:{1:1,2:0.75,4:0.4},4:{1:1.4,2:0.9,4:0.7},8:{1:1.45,2:1.05,4:0.7},16:{1:1,2:0.8,4:0.6},32:{1:1.1,2:0.9,4:0.7}},4:{1:{1:1,2:0.9,4:0.5},4:{1:1.35,2:0.95,4:0.7},16:{1:0.75,2:1.1,4:0.75}},8:{1:{1:0.7,2:1,4:0.9},4:{1:1.4,2:1.1,4:0.9},16:{1:0.3,2:1.3,4:1.1},128:{1:1.4,2:1.1,4:0.9},256:{1:1.45,2:1.05,4:0.7}},16:{1:{1:0.8,2:1,4:1.3},64:{1:0.8,2:1,4:1.3}},32:{1:{1:0.8,2:1,4:1.3},64:{1:0.8,2:1,4:1.3}},64:{},128:{},256:{1:{1:0.8,2:1,4:1.3}}},DMapAvoidVal={1:{1:3,2:3,3:3,4:4},2:{1:4,2:4,3:5,4:5},3:{1:6,2:6,3:7,4:7},4:{1:8,2:8,3:9,4:9},5:{1:10,2:10,3:11,4:11},6:{1:12,2:12,3:13,4:13},7:{1:14,2:14,3:15,4:15},8:{1:16,2:17,3:17,4:18},9:{1:17,2:18,3:18,4:19},10:{1:18,2:19,3:19,4:20},11:{1:19,2:20,3:20,4:21},12:{1:20,2:21,3:21,4:22}},NUM_ATTRS=12,DEFAULT_CRIT_RATE=0.05,DRATE=[25,0.02,0.0002,2000,0.1,0.8,150],DEFAULT_CRIT_DMG=1.5;function pathSkillIcon(r,o){let g="img/skills/"+r+".jpg";return o&&"../"+g,g}function pathShipIcon(r,o){let g="img/ship-icons/"+r+".png";return o&&"../"+g,g}function pathEquipIcon(r,o){let g="img/equip/"+r+".png";return o&&"../"+g,g}function loadIfExists(r,o,g){return o in r?r[o]:g}var DAmmoFunc={neutral:function(r){return r},plenty:function(r){return r+0.1},empty:function(r){return r-0.5}},DFormationFunc={0:function(r){return r},1:function(r){return r[EAttributes.CANNON]+=0.15,r[EAttributes.TORP]+=0.15,r[EAttributes.EVA]-=0.1,r},2:function(r){return r[EAttributes.CANNON]-=0.05,r[EAttributes.TORP]-=0.05,r[EAttributes.EVA]+=0.3,r},3:function(r){return r[EAttributes.AA]+=0.2,r}},DAffectionLevels={NORMAL:0,FRIENDLY:1,LIKE:2,LOVE:3,OATH:4,OATHMAX:5,stats:{0:{affection:31,ringed:!1},1:{affection:61,ringed:!1},2:{affection:81,ringed:!1},3:{affection:100,ringed:!1},4:{affection:100,ringed:!0},5:{affection:200,ringed:!0}}},DLBLimits={0:{maxLvl:70,minLvl:1},1:{maxLvl:80,minLvl:10},2:{maxLvl:90,minLvl:30},3:{maxLvl:120,minLvl:70}},DPrDevToLB={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:1,11:1,12:1,13:1,14:1,15:1,16:1,17:1,18:1,19:1,20:2,21:2,22:2,23:2,24:2,25:2,26:2,27:2,28:2,29:2,30:3};function calcStat(r,o,g,h){return 100<r?o+(r-1)*g/1e3+(r-100)*h/1e3:o+(r-1)*g/1e3}function calcEnhance(r,o){return r=Math.min(r,100),100==r?o:Math.floor((0.7*(r/100)+0.3)*o)}function calcEnhancePr(){}function getIntimacyMult(r,o){return 60<r&&80>=r?1.01:81<=r&&100>r?1.03:100!=r||o?100<=r&&200>r&&o?1.09:200==r&&o?1.12:1:1.06}function isWeapon(){return!1}function createEquipment(r,o,g){if(o){let h=null;return h=g&&0!=(g&(EGunType.AIRCRAFT|EGunType.ASW_PLANES))?new AircraftEquipment(r):new WeaponEquipment(r),h.default=!0,h}let h=dbLoadEquipMap(r),S=loadEquipData(h.base);return 1==S.isWeapon?0==((EGunType.AIRCRAFT|EGunType.SPECIAL|EGunType.ASW_PLANES)&S.type)?new WeaponEquipment(r):new AircraftEquipment(r):new TrueEquipment(r)}function calcCritRate(r,o){let g=r.getCombatStat(EAttributes.HIT),h=r.getCombatStat(EAttributes.LUCK),S=r.getLevel(),I=o.getCombatStat(EAttributes.EVA),A=o.getCombatStat(EAttributes.LUCK),y=o.getLevel();return DEFAULT_CRIT_RATE+g/(g+I+DRATE[3])+(h-A+(S-y))*DRATE[2]}function calcHitRate(r,o){let g=r.getCombatStat(EAttributes.HIT),h=r.getCombatStat(EAttributes.LUCK),S=r.getLevel(),I=o.getCombatStat(EAttributes.EVA),A=o.getCombatStat(EAttributes.LUCK),y=o.getLevel();return 0.1+g/(g+I+2)+(h-A+(S-y))/1e3}function calcEffHP(r,o){let g=r.getCombatStat(EAttributes.DURABILITY);return g/o}function calcAirResistance(r){return 1-150/(150+r)}function calcReloadForGun(r,o){return(o.getReload()/(6*Math.sqrt(3.14*(100+r)))).toFixed(2)}function calcOilConsumption(r){let o=Math.min(9950,5e3+50*r.getLevel());return r.oilStart+Math.floor(r.oilEnd*o/1e4)}function calcAirstrikeReload(r,o){if(!r.isType(EClass.CARRIER_CLASS))return 0;let g=0,h=0,S=r.slots;for(let y,A=0;A<S.length;A++)y=S[A],0!=(y.typeMask&(EGunType.AIRCRAFT|EGunType.SPECIAL))&&(g+=y.eq.getReloadTime()*y.getMountNo(),h+=y.getMountNo());let I=g/h;return 2.18*I*Math.sqrt(200/(100+o))+0.3}function calcAirstrikeReloadTwo(r,o){if(!r.isType(EClass.CARRIER_CLASS))return 0;let g=0,h=0,S=r.slots;for(let y,A=0;A<S.length;A++)y=S[A],0!=(y.typeMask&(EGunType.AIRCRAFT|EGunType.SPECIAL))&&(g+=y.eq.getReload()*y.getMountNo(),h+=y.getMountNo());let I=2.2*g/h;return I/(6*Math.sqrt(3.14*(100+o)))}function calcLevelAdvantage(r,o,g){return 1+0.02*Math.min(25,Math.max(-25,g+r.getLevel()-o.getLevel()))}function calcArmorMods(r,o,g){let h=g.getModifiers();return h[o.getArmor()-1]}var PROP_LIST=["extraCritRate","extraEvaRate","eHP","airResist","dmgReceiveRatio","dmgRatio","extraDmgAmmo","reduceDmgAmmo","dmgToNation","accuracyToShipType","dmgToShipType","dmgReceiveByWeap","extraCritDmg"];function initProps(r){r.extraCritRate=0,r.extraEvaRate=0,r.eHP=0,r.airResist=0,r.dmgReceiveRatio=1,r.dmgRatio=1,r.extraDmgAmmo=[1,1,1],r.reduceDmgAmmo=[0,0,0],r.extraCritDmg=0,r.extraCritRateIdx=[0,0,0,0,0,0,0],r.extraCritDmgIdx=[0,0,0,0,0,0,0],r.dmgRatioIdx=[0,0,0,0,0,0,0],r.dmgToNation={};let o=Object.keys(EFaction.props);for(let S=0;S<o.length;S++)r.dmgToNation[o[S]]=1;r.dmgToShipType={};let g=Object.keys(EClass.props);for(let S=0;S<g.length;S++)r.dmgToShipType[g[S]]=1;r.accuracyToShipType={};for(let S=0;S<g.length;S++)r.accuracyToShipType[g[S]]=0;r.dmgReceiveByWeap={};let h=Object.keys(EGunType.props);for(let S=0;S<h.length;S++)r.dmgReceiveByWeap[h[S]]=1;r.initialEnhancement=0,r.manualEnhancement=0,r.efficiencyIdx=[];for(let S=0;7>S;S++)r.efficiencyIdx[S]=0}function initStatArgs(r,o,g,h){let S={};return S.atkProps={},S.defProps={},initProps(S.atkProps),initProps(S.defProps),S.attacker=r,S.defender=o,S.equip=g,S.slotNo=0,S.eff=1,S.mounts=1,h&&(S.slotNo=h.getSlotNo(),S.eff=h.getEfficiency(),S.mounts=h.getMountNo()),S.dangerLvl=0,S.isManual=!1,S.isBBMainGun=!1,h&&(S.isBBMainGun=h.isType(EGunType.BB_GUN)),S}function computeStats(r){let o=r.attacker,g=r.defender;r.atkProps.critRate=Math.min(1,calcCritRate(o,g)+r.atkProps.extraCritRate+r.atkProps.extraCritRateIdx[r.slotNo]),r.atkProps.hitRate=Math.max(0.1,Math.min(0.9,calcHitRate(o,g)-r.defProps.extraEvaRate+r.atkProps.accuracyToShipType[g.getType()])),r.defProps.critRate=Math.min(1,calcCritRate(g,o)+r.defProps.extraCritRate+r.defProps.extraCritRateIdx[r.slotNo]),r.defProps.hitRate=Math.max(0.1,Math.min(0.9,calcHitRate(g,o)-r.atkProps.extraEvaRate+r.defProps.accuracyToShipType[o.getType()])),r.atkProps.eHP=calcEffHP(o,r.defProps.hitRate),r.defProps.eHP=calcEffHP(g,r.atkProps.hitRate),r.atkProps.airResist=calcAirResistance(o.getCombatStat(EAttributes.AA)),r.defProps.airResist=calcAirResistance(g.getCombatStat(EAttributes.AA)),r.lvlMult=calcLevelAdvantage(o,g,r.dangerLvl)}function calcDamage(r){let o=r.attacker,g=r.defender,h=r.equip,S=h.getWeapons();r.weapons={};for(let A,I=0;I<S.length;I++)if(A=S[I],!A.isType(EWeaponTypes.ANTI_AIR)){let H=A.getCorrectedDamage(r.eff),q=H*A.getScaledStat(o.getCombatStats()),F=r.defProps.dmgReceiveByWeap[A.getDamageAttr()],V=r.atkProps.dmgToNation[g.getNation()],G=r.defProps.dmgReceiveRatio,W=r.atkProps.dmgRatio+r.atkProps.dmgRatioIdx[r.slotNo],K=r.atkProps.dmgToShipType[g.getType()],Y=1;A.getDamageAttr()==EAttributes.AIR&&(Y=1-r.defProps.airResist),A.getDamageAttr()==EAttributes.TORP&&(W+=r.atkProps.dmgRatioIdx[5]);let Q=Y*F*V*G*W*K*r.lvlMult,z={};z.weapDamage=[q,q+2],z.weapMults=Q,z.bullets={};let X=A.getBullets();for(let Z,J=0;J<X.length;J++)Z=calcDamageBullet(r,A,X[J].obj,z,A.getSpawns()*X[J].num),z.bullets[J]=Z;r.weapons[I]=z}}function calcDamageBullet(r,o,g,h,S){let I={},A=r.attacker,y=r.defender,E=A.getFixedAmmo(r.slotNo);E||(E=g);let x=A.getFixedMods(r.slotNo);x||(x=calcArmorMods(A,y,E));let L=0,D=1,R=E.getAmmoType();3>=R&&(L=r.defProps.reduceDmgAmmo[R-1],D=r.atkProps.extraDmgAmmo[R-1]);let T=x*(D-L),P=DEFAULT_CRIT_DMG+r.atkProps.extraCritDmg+r.atkProps.extraCritDmgIdx[r.slotNo],C=0;o.getDamageAttr()==EAttributes.TORP&&(P+=r.atkProps.extraCritDmgIdx[5],C+=r.atkProps.extraCritRateIdx[5]),I.critRateBullet=Math.min(1,r.atkProps.critRate+C),I.bulletDmg=[],I.totalDmg=[],I.critDmg=[];let N=1;r.isBBMainGun&&(N+=r.atkProps.initialEnhancement,r.isManual&&(N+=0.2+r.atkProps.manualEnhancement));let _=N,B=h.weapDamage;for(let U=0;U<B.length;U++){let M=B[U],H=M*h.weapMults*T,q=H*P,O=Math.floor(_*Math.floor(H)),F=Math.floor(_*Math.floor(q)),V=Math.floor(H),G=Math.floor(S*(O+V*Math.max(0,r.mounts-1)));I.bulletDmg.push(Math.floor(H)),I.totalDmg.push(G),I.critDmg.push(Math.floor(q)),I.critDmgEnh.push(F)}return I}var DTranslatePropString={dmgRatio:"Damage dealt $1",accuracyToShipType:"Accuracy rate $1 against $2",extraEvaRate:"Evasion rate $1",extraCritRate:"Critical rate $1",dmgReceiveRatio:"Damage received $1",extraCritDmg:"Critical damage $1",extraDmgAmmo:"Damage dealt $1 with $2",reduceDmgAmmo:"Damage received -$1 by $2",extraCritRateIdx:"Critical rate $1 with $2",extraCritDmgIdx:"Critical damage $1 with $2",dmgRatioIdx:"Damage dealt $1 against $2",dmgToNation:"Damage dealt $1 against $2",dmgToShipType:"Damage dealt $1 to $2",dmgReceiveByWeap:"Damage received $1 by $2",manualEnhancement:"Manual damage $1",initialEnhancement:"First salvo damage $1",efficiencyIdx:"Increases efficiency of $1 by $2"},DTranslateProps={accuracyToShipType:EClass.props,extraDmgAmmo:{0:{name:"normal ammo"},1:{name:"AP ammo"},2:{name:"HE ammo"}},reduceDmgAmmo:{0:{name:"normal ammo"},1:{name:"AP ammo"},2:{name:"HE ammo"}},extraCritRateIdx:{0:{name:"Barrage"},1:{name:"Eq. slot #1"},2:{name:"Eq. slot #2"},3:{name:"Eq. slot #3"},4:{name:"Eq. slot #4"},5:{name:"Torpedoes"},6:{name:"Fixed gun"}},extraCritDmgIdx:{0:{name:"Barrage"},1:{name:"Eq. slot #1"},2:{name:"Eq. slot #2"},3:{name:"Eq. slot #3"},4:{name:"Eq. slot #4"},5:{name:"Torpedoes"},6:{name:"Fixed gun"}},dmgRatioIdx:{0:{name:"Barrage"},1:{name:"Eq. slot #1"},2:{name:"Eq. slot #2"},3:{name:"Eq. slot #3"},4:{name:"Eq. slot #4"},5:{name:"Torpedoes"},6:{name:"Fixed gun"}},dmgToNation:EFaction.props,dmgToShipType:EClass.props,dmgReceiveByWeap:EAttributes.props,efficiencyIdx:{0:{name:"Eq. slot #1"},1:{name:"Eq. slot #2"},2:{name:"Eq. slot #2"},3:{name:"Eq. slot #3"},4:{name:"Eq. slot #4"},5:{name:"Torpedoes"},6:{name:"Fixed gun"}}};function buffToString(r){if(r.isStat){let o=r.number,g="";return r.isRatio&&(g="%",o*=100),r.isRatio||(o=Math.floor(o)),o=0<o?"+"+o.toFixed(1):o.toFixed(1),EAttributes.props[r.attrIdx].name+" "+o+g}if(r.attr in DTranslatePropString){let o=r.number,g="";g="%",o*=100,o=0<o&&"reduceDmgAmmo"!=r.attr?"+"+o.toFixed(1):o.toFixed(1);let h=[o+g];if(r.isIndexed&&r.attr in DTranslateProps){let y=DTranslateProps[r.attr];h.push(y[r.idx].name)}let S="";if(r.index){let y=DTranslateProps[r.attr+"Idx"];h.push(y[Math.max(r.index[0],0)].name),S=DTranslatePropString[r.attr+"Idx"]}else S=DTranslatePropString[r.attr];for(let I=null,A=/\$([\d+])/m;I=A.exec(S);)if(I&&"1"in I){let y=parseInt(I[1]);S=S.replace(A,h[y-1])}return S}return""}class BuffAddAttr{constructor(r,o){this.argsData=o,this.id=r,this.number=o.number,this.attrIdx=o.attrIdx,this.idx=o.idx,this.attr=o.attr,this.isStat="attrIdx"in o,this.isIndexed="idx"in o,this.isRatio=!1,this.subIdx="props",this.isStat&&(this.subIdx="stats")}apply(r){if(this.stacks=1,"stacks"in r&&(this.stacks=r.stacks),this.statConversion){let o=r.ship.getFullStat(this.convAttrIdx);this.number=this.convRatio*o}r.skillDict.setValue(this)}setParent(r){this.skill=r}getSkill(){return this.skill}getString(){return buffToString(this)}}class BuffAddAttrRatio extends BuffAddAttr{constructor(r,o){super(r,o),this.number*=1e-4,this.isRatio=!0,this.subIdx="statsR",this.statConversion=!1,"convertAttr"in o&&(this.statConversion=!0,this.convAttrIdx=o.convAttrIdx,this.convRatio=this.number,this.subIdx="stats",this.isRatio=!1)}getString(){return buffToString(this)}}class BuffShiftBullet{constructor(r,o){this.id=r,this.bullet=BULLETS_INSTANCE_DB[o.bullet_id],this.index=o.index}apply(r){let o=r.ship;if(o)for(let g=0;g<this.index.length;g++)o.setFixedAmmo(this.index[g],this.bullet)}getSkill(){return this.skill}setParent(r){this.skill=r}getString(){return buffToString(this)}}class BuffFixAmmo{constructor(r,o){this.id=r,this.mod=o.damage_rate,this.index=o.index}apply(r){let o=r.ship;if(o)for(let g=0;g<this.index.length;g++)o.setFixedMods(this.index[g],this.mod)}getSkill(){return this.skill}setParent(r){this.skill=r}getString(){return buffToString(this)}}class BuffAddReloadReq{constructor(r,o){this.id=r,this.number=o.number,this.type=o.type}apply(r){let o=r.ship;o&&o.setReloadReq(this.type,this.number)}getSkill(){return this.skill}setParent(r){this.skill=r}getString(){return buffToString(this)}}class BuffAddBulletAttr{constructor(r,o){this.id=r,this.number=o.number,this.attr=o.attr,this.index=o.index,this.subIdx="props"}apply(r){this.stacks=1,"stacks"in r&&(this.stacks=r.stacks),r.skillDict.setValue(this)}getSkill(){return this.skill}setParent(r){this.skill=r}getString(){return buffToString(this)}}class BuffAddProficiency{constructor(r,o){this.id=r,this.number=o.number,this.type=o.type,this.index=o.index,this.nationality=[],"nationality"in o&&(this.nationality=o.nationality),this.slot=[],"slot"in o&&(this.slot=o.slot),this.index=this.slot,this.subIdx="props",this.attr="efficiency"}apply(r){this.stacks=1,"stacks"in r&&(this.stacks=r.stacks);for(let g,o=0;o<this.slot.length;o++)if(g=this.slot[o],6==g)this.index=[6],r.skillDict.setValue(this);else{let h=r.ship.getSlots()[g-1];if(h.isWeapon()){let S=h.getEquipment();if(0<this.nationality.length&&-1==this.nationality.indexOf(S.getNation()))continue;this.index=[g],r.skillDict.setValue(this)}}}getSkill(){return this.skill}setParent(r){this.skill=r}getString(){return buffToString(this)}}function buildLeafEffect(r,o,g){switch(g){case EEffectTypes.ADD_ATTR_RATIO:return new BuffAddAttrRatio(r,o);break;case EEffectTypes.ADD_ATTR:return new BuffAddAttr(r,o);break;case EEffectTypes.ADD_BULLET_ATTR:return new BuffAddBulletAttr(r,o);break;case EEffectTypes.ADD_RELOAD_REQ:return new BuffAddReloadReq(r,o);break;case EEffectTypes.BUFF_AURA:return new BuffAura(r,o);break;case EEffectTypes.SHIFT_BULLET:return new BuffShiftBullet(r,o);break;case EEffectTypes.FIX_AMMO:return new BuffFixAmmo(r,o);break;case EEffectTypes.ADD_PROFICIENCY:return new BuffAddProficiency(r,o);}return null}function initPropsMeta(){let r=Object.keys(EFaction.props);DPropMeta.dmgToNation.dim=r.length,DPropMeta.dmgToNation.keys=r,r=Object.keys(EClass.props),DPropMeta.dmgToShipType.dim=r.length,DPropMeta.dmgToShipType.keys=r,DPropMeta.accuracyToShipType.dim=r.length,DPropMeta.accuracyToShipType.keys=r,r=Object.keys(EGunType.props),DPropMeta.dmgReceiveByWeap.dim=r.length,DPropMeta.dmgReceiveByWeap.keys=r}var DPropMeta={dmgRatio:{dim:0},extraEvaRate:{dim:0},extraCritRate:{dim:0},dmgReceiveRatio:{dim:0},extraCritDmg:{dim:0},extraDmgAmmo:{dim:3},reduceDmgAmmo:{dim:3},extraCritRateIdx:{dim:7},extraCritDmgIdx:{dim:7},dmgRatioIdx:{dim:7},dmgToNation:{},dmgToShipType:{},dmgReceiveByWeap:{},accuracyToShipType:{},manualEnhancement:{dim:0},initialEnhancement:{dim:0},efficiencyIdx:{dim:7}},LPropList=["dmgRatio","accuracyToShipType","extraEvaRate","extraCritRate","dmgReceiveRatio","extraCritDmg","extraDmgAmmo","reduceDmgAmmo","extraCritRateIdx","extraCritDmgIdx","dmgRatioIdx","dmgToNation","dmgToShipType","dmgReceiveByWeap","manualEnhancement","initialEnhancement","efficiencyIdx"];class SkillEffectAcc{constructor(){this.skillDict={}}aggregateBuffs(r){let g={},h=Object.keys(this.skillDict);for(let S=0;S<h.length;S++){let I=this.skillDict[h[S]],A=I.stats,y=I.statsR;for(let x=0;x<A.length;x++){let L=A[x],D=y[x];if(0<L.id){L.id in g||(g[L.id]=[]),g[L.id].push(L.getSkill());let R=L.getValue();r.stats[x]+=R}if(0<D.id){D.id in g||(g[D.id]=[]),g[D.id].push(D.getSkill());let R=D.getValue();r.statsR[x]+=R}}let E=I.props;for(let x=0;x<LPropList.length;x++){let L=LPropList[x],D=DPropMeta[L];if(0==D.dim){let R=E[L].id;0<R&&(!(R in g)&&(g[R]=[]),g[R].push(E[L].getSkill()),r.props[L]+="dmgGetRatio"==L?(1-r.props[L])*E[L].getValue():E[L].getValue())}else if("keys"in D){let R=D.keys;for(let P,T=0;T<R.length;T++)P=E[L][R[T]].id,0<P&&(!(P in g)&&(g[P]=[]),g[P].push(E[L][R[T]].getSkill()),r.props[L][R[T]]+=E[L][R[T]].getValue())}else for(let T,R=0;R<D.dim;R++)T=E[L][R].id,0<T&&(!(T in g)&&(g[T]=[]),g[T].push(E[L][R].getSkill()),r.props[L][R]+=E[L][R].getValue())}}r.skillLst=g}applyIfExists(r,o,g){0<o.id&&(g.push(o.skill.getSkill().getIcon()),r+=o.getValue())}setValue(r){let o=r.id,g=r.number*r.stacks;o in this.skillDict||(this.skillDict[o]={},this.initEntry(this.skillDict[o]));let h=this.skillDict[o];if(r.isStat)h[r.subIdx][r.attrIdx]||(h[r.subIdx][r.attrIdx]=new SkillDictEntry({id:r.id})),h[r.subIdx][r.attrIdx].setValue(r,g);else if(r.isIndexed)h[r.subIdx][r.attr][r.idx].setValue(r,g);else if(r&&r.index){h[r.subIdx][r.attr+"Idx"]||(h[r.subIdx][r.attr+"Idx"]={});for(let I,S=0;S<r.index.length;S++)I=r.index[S],-1==I&&(I=0),h[r.subIdx][r.attr+"Idx"][I]||(h[r.subIdx][r.attr+"Idx"][I]=new SkillDictEntry({})),h[r.subIdx][r.attr+"Idx"][I].setValue(r,g)}else h[r.subIdx][r.attr]||(h[r.subIdx][r.attr]=new SkillDictEntry({})),h[r.subIdx][r.attr].setValue(r,g)}initEntry(r){r.stats=[],r.statsR=[],r.props={};for(let S=0;S<NUM_ATTRS;S++)r.stats[S]=new SkillDictEntry({}),r.statsR[S]=new SkillDictEntry({});r.props.extraCritRate=new SkillDictEntry({}),r.props.extraEvaRate=new SkillDictEntry({}),r.props.dmgReceiveRatio=new SkillDictEntry({}),r.props.dmgRatio=new SkillDictEntry({}),r.props.extraDmgAmmo=[new SkillDictEntry({}),new SkillDictEntry({}),new SkillDictEntry({})],r.props.reduceDmgAmmo=[new SkillDictEntry({}),new SkillDictEntry({}),new SkillDictEntry({})],r.props.extraCritDmg=new SkillDictEntry({}),r.props.extraCritRateIdx=[],r.props.extraCritDmgIdx=[],r.props.dmgRatioIdx=[];for(let S=0;7>S;S++)r.props.extraCritRateIdx[S]=new SkillDictEntry({}),r.props.extraCritDmgIdx[S]=new SkillDictEntry({}),r.props.dmgRatioIdx[S]=new SkillDictEntry({});r.props.dmgToNation={};let o=Object.keys(EFaction.props);for(let S=0;S<o.length;S++)r.props.dmgToNation[o[S]]=new SkillDictEntry({});r.props.dmgToShipType={};let g=Object.keys(EClass.props);for(let S=0;S<g.length;S++)r.props.dmgToShipType[g[S]]=new SkillDictEntry({});r.props.accuracyToShipType={};for(let S=0;S<g.length;S++)r.props.accuracyToShipType[g[S]]=new SkillDictEntry({});r.props.dmgReceiveByWeap={};let h=Object.keys(EGunType.props);for(let S=0;S<h.length;S++)r.props.dmgReceiveByWeap[h[S]]=new SkillDictEntry({});r.props.manualEnhancement=new SkillDictEntry({}),r.props.initialEnhancement=new SkillDictEntry({}),r.props.efficiencyIdx=[];for(let S=0;7>S;S++)r.props.efficiencyIdx[S]=new SkillDictEntry({})}}class SkillDictEntry{constructor(r){r&&(this.id=r.id||-1,this.nVal=r.nVal||0,this.pVal=r.pVal||0,this.default=r.default||0)}setValue(r,o){0<o&&o>this.pVal?(this.id=r.id,this.pVal=o,this.skill=r.skill):0>o&&o<this.nVal&&(this.id=r.id,this.nVal=o,this.skill=r.skill)}getValue(){return this.pVal+this.nVal}getSkill(){return this.skill}}var PROP_LIST=["extraCritRate","extraEvaRate","eHP","airResist","dmgReceiveRatio","dmgRatio","extraDmgAmmo","reduceDmgAmmo","dmgToNation","dmgToShipType","dmgReceiveByWeap","extraCritDmg"],EEffectTypes={ADD_ATTR_RATIO:1,ADD_ATTR:2,ADD_BULLET_ATTR:4,ADD_RELOAD_REQ:8,BUFF_AURA:16,SHIFT_BULLET:32,FIX_AMMO:64,CANCEL_BUFF:128,ADD_PROFICIENCY:256},ETargetTypes={LEAST_HP_RATIO:1,PLAYER_BY_TYPE:2,VANGUARD:4,MAIN_FLEET:8,ALL_HELP:16,SELF:32,NIL:64,RANDOM_WEIGHT_ENEMIES:128,NEAREST_ENEMY:256,SHIP_TAG:512,ALL_ENEMIES:1024,SAME_LAST_EFF:2048,NATIONALITY_FRIENDLY:4096,RANDOM:8192,NATIONALITY:16384,SHIP_TYPE:32768,CHECK_TARGET:262144,ON_FLAGSHIP:65536,ON_LEADER:131072,CHECK_WEAPON:524288,TARGET_TEMPLATE:1048576,TARGET_FLAGSHIP:2097152},DValidateFunctions={2:function(r,o){return r.ship&&!r.ship.isEnemy()&&r.ship.isType(o.shipType)},4:function(r){return r.ship&&r.ship.isVanguard()},8:function(r){return r.ship&&r.ship.isMainFleet()},16:function(r,o){if(r.ship&&"effectFilter"in o){let h=o.effectFilter;for(let S=0;S<h.length;S++)if(h[S][2]==r.ship.getTemplId())return!0;return!1}return r.ship&&!r.ship.isEnemy()},32:function(r){return r.owner&&r.ship&&r.owner.getId()==r.ship.getId()},128:function(r){return r.ship&&r.ship.isEnemy()},512:function(r,o){if(!r.ship)return!1;let g=o.ship_tag_list;g instanceof Array||(g=[g]);let h=r.ship.getTagList();for(let S=0;S<h.length;S++)if(-1!=g.indexOf(h[S]))return!0;return!1},1024:function(r){return r.ship&&r.ship.isEnemy()},4096:function(r,o){if(r.ship){if(r.ship.isEnemy()||r.ship.getId()==r.owner.getId()&&!r.affectsSelf)return!1;let g=r.ship.getNation(),h=o.nationality;return h instanceof Array?-1!=h.indexOf(g):g==h}},8192:function(r){return r.ship&&r.ship.isEnemy()},16384:function(r,o){if(r.ship){let g=r.ship.getNation(),h=o.nationality;return h instanceof Array?-1!=h.indexOf(g):g==h}},32768:function(r,o){if(r.ship){let g=r.ship.getType(),h=o.ship_type_list;return h instanceof Array?-1!=h.indexOf(g):g==h}},65536:function(r){return r.owner&&r.owner.isFlagship()},131072:function(r,o){let g=!0;return"TargetSelf"==o.target&&(g=r.owner.getId()==r.ship.getId()),r.owner&&r.owner.isLeader()&g},1048576:function(r,o){if(r.ship){let g=r.ship.getTemplId(),h=o.targetTemplateIDList;return h instanceof Array?-1!=h.indexOf(g):g==h}},2097152:function(r){return r.ship&&r.ship.isFlagship()}};function evaluateCheckTarget(r,o,g){switch(r){case"TargetPlayerVanguardFleet":return targetPlayerVanguard(o);break;case"TargetNationality":return targetNationality(o,g);break;case"TargetTemplate":return targetTemplate(o,g);break;case"TargetShipTag":return targetShipTag(o,g);break;case"TargetNationalityFriendly":return targetNationality(o,g);break;case"TargetWeapon":return targetWeapon(o,g);break;case"TargetShipTypeFriendly":return targetShipType(o,g);return;}return[]}function targetPlayerVanguard(r){let o=[];if(r.currLst){for(let g=0;g<r.currLst.length;g++)r.currLst[g].isVanguard()&&o.push(r.currLst[g]);return o}return r.fleet.getFrontline()}function targetNationality(r,o){let g=[],h=r.fleet.getShips();r.currLst&&(h=r.currLst);let S=o.nationality;S instanceof Array||(S=[S]);for(let I=0;I<h.length;I++)-1!=S.indexOf(h[I].getNation())&&g.push(h[I]);return g}function targetTemplate(r,o){let g=[],h=r.fleet.getShips();r.currLst&&(h=r.currLst);let S=o.targetTemplateIDList;S instanceof Array||(S=[S]);for(let I=0;I<h.length;I++)-1!=S.indexOf(h[I].getTemplId())&&g.push(h[I]);return g}function targetShipTag(r,o){let g=[],h=r.fleet.getShips();r.currLst&&(h=r.currLst);let S=o.ship_tag_list;S instanceof Array||(S=[S]);for(let A,I=0;I<h.length;I++){A=h[I].getTagList();for(let y=0;y<A.length;y++)if(-1!=S.indexOf(A[y])){g.push(h[I]);break}}return g}function targetWeapon(r,o){let g=[],h=o.weapon_group;h instanceof Array||(h=[h]);let S=r.ship.getSlots();for(let I=0;I<S.length;I++){let A=S[I],y=A.getEquipment();y&&-1!=h.indexOf(y.getId())&&g.push(!0)}return g}function targetShipType(r,o){let g=[],h=r.fleet.getShips();r.currLst&&(h=r.currLst);let S=o.ship_type_list;S instanceof Array||(S=[tagLst]);for(let I=0;I<h.length;I++)-1!=S.indexOf(h[I].getType())&&g.push(h[I]);return g}function addAttrRatio(r,o,g){let h=1e-4*o.number,S=null;if(r.id in g||(g[r.id]={skillId:r.skillId}),S=g[r.id],"attrIdx"in o){let I=o.attrIdx;attrs.stats[I]+=1e-4*h}else attrs.props[o.attr]+=1e-4*h}function addAttr(r,o){if("attrIdx"in o){let g=o.attrIdx,h=o.number;attrs.stats[g]+=h}else{let g=o.number;r.props[o.attr]+=g}}var DAttrConv={cannon:{icon:"fp",name:"Firepower"},dodge:{icon:"eva",name:"Evasion"},torpedo:{icon:"torp",name:"Torpedo"},durability:{icon:"hp",name:"Health"},reload:{icon:"rel",name:"Reload"},antiaircraft:{icon:"aa",name:"Anti-air"},air:{icon:"air",name:"Air Power"},damage:{name:"Damage",abbrev:"Dmg"},hit:{name:"Hit",abbrev:"Hit"},luck:{name:"Luck",abbrev:"Luck"}};function convertDescsToCtrls(r){let g="";for(let h=0;h<r.length;h++){let S=r[h],I="";if(S.name in DAttrConv){let A=DAttrConv[S.name];I="icon"in A?"<img class='attricon' title='"+DAttrConv[S.name].name+"' src='img/attr/"+DAttrConv[S.name].icon+".png' />":"<div style='margin-left:5px; color:white;'>"+A.abbrev+"</div>"}else I="<div style='margin-left:5px; color:white;'>"+S.name+"</div>";g+="<div class='eattr' title=''>"+I+"<div class='eattrval' style='margin-right:5px;'>"+S.val+"</div></div>"}return g}var DAttrIdxConv={0:"hp",1:"fp",2:"torp",3:"aa",4:"air",5:"rel",6:"armor",7:"hit",8:"eva",9:"speed",10:"luck",11:"asw"};function buildBarrageBody(r,o){let g="";o&&(g+="show active");let h=r.getId();return"<div class='tab-pane "+g+" barrage' role='tabpanel' data-sid='"+h+"' id='s"+h+"'><div class='barrage-icon'><div class='bskill-icon'></div></div><div class='barrage-base'><div style='display:flex; width:100%; align-content: space-between; flex-wrap: nowrap'><select class='barrage-upg-sel'></select><div class='barrage-name'>Triple 155mm</div><span class='fa fa-info-circle clickable-icon' aria-hidden='true'></span></div><div class='barrage-info'></div></div></div>"}function buildBarrageTab(r,o){let g=r.getId(),h="false",S="";o&&(h+="true",S="active");let I="";return r.isSkillBarrage()?I="Skill":r.isGunBarrage()&&(I="Gun"),"<li class='nav-item barr-nav'><a style='padding:2px; padding-left:10px; padding-right:10px;' class='nav-link "+S+"' data-toggle='tab' href='#s"+g+"' role='tab' aria-selected='"+h+"'>"+I+"</a></li>"}function buildBarrageWeaponHtml(r){let o="<div><div class='eattr' title='Damage'><div style='margin-left:5px; color:white;'>Dmg</div><div class='eattrval' style='margin-right:5px;'>"+r.dmg+" x "+r.ammo+"</div></div><div class='eattr' style='justify-content:center;' title='Scaling'><div class='eattrval' style='width:auto; margin-right:0px;'>"+r.scale+"%</div><img class='attricon' src='img/attr/"+DAttrIdxConv[r.dmgAttr]+".png' /></div></div>",g="",h=r.props;for(let x=0;x<h.length;x++)g+="<img width='25' src='img/at-"+h[x]+".png' />";let S="<div class='barr-props' style='width:25px; display:flex; flex-direction:column;'>"+g+"</div>",I="",A=r.bullets;for(let x=0;x<A.length;x++){let L=A[x].mods,D="<tr><td>Bullet"+x+"</td><td>"+A[x].ammo+"</td><td>"+(100*L[0]).toFixed(0)+"%</td><td>"+(100*L[1]).toFixed(0)+"%</td><td>"+(100*L[2]).toFixed(0)+"%</td></tr>";I+=D}let y="<div style='height: 100%; margin-left: 10px;'><table class='mods-tbl' cellspacing = '5'><tbody class='pre-mount-tbl-body' style='text-align:center;'><tr><td></td><td>Qty</td><td>L</td><td>M</td><td>H</td></tr>"+I+"</tbody></table></div >";return"<div class='barrage-weap'><div style='display: flex; flex-direction: row; margin-top: 4px; align-items: center;'>"+(o+S+y)+"</div></div>"}function buildEnemyEntryHtml(r){let o="<div class='enemy-icon'><img style='height:65px; width:65px;' src='data/enemy-icons/"+r.icon+".png' /></div>",g="";r.type in EShipTypesIcon&&(g="<img style='height:100%' src='img/ship-types/"+EShipTypesIcon[r.type]+".png' />");let h="<div class='enemy-desc-row'><div style='margin-right:5px;'>Lv. "+r.lvl+"</div><div style='height:100%; width:auto; margin-right:5px;'>"+g+"</div><div class='enemy-name'>"+r.name+"</div></div >",S="<div class='enemy-desc-row'><div class='eattr enattr' title='Health'><img class='attricon' title='Health' src='img/attr/hp.png' /><div class='eattrval' style='margin-right:5px;'>"+r.getStat(EAttributes.DURABILITY)+"</div></div><div class='eattr enattr-short' title='Evasion'><img class='attricon' title='Evasion' src='img/attr/eva.png' /><div class='eattrval' style='margin-right:5px;'>"+r.getStat(EAttributes.EVA)+"</div></div><div class='eattr enattr-short' title='Anti-Air'><img class='attricon' title='Anti-Air' src='img/attr/aa.png' /><div class='eattrval' style='margin-right:5px;'>"+r.getStat(EAttributes.AA)+"</div></div></div>",I="<div class='enemy-desc-row'><div class='eattr enattr' title=''><img class='attricon' title='Armor' src='img/attr/armor.png' /><div class='eattrval' style='margin-right:5px;'>"+EArmorType.props[r.armor].code+"</div></div><div class='eattr enattr-short' title='Luck'><div style='margin-left:5px; color:white;'>Luck</div><div class='eattrval'>"+r.getStat(EAttributes.LUCK)+"</div></div></div>";return"<div class='enemy-base'>"+o+("<div class='enemy-desc'>"+h+S+I+"</div>")+"</div>"}function getSkillEntryHtml(r,o){let g=o.isEnabled(),h=o.isValid(),S="";g&&(S="checked");let I="<div class='custom-control custom-checkbox' style='margin-left:10px;'><input "+S+" type='checkbox' class='custom-control-input checkSkillEnabled' id='checkSkillEnabled"+r+"' name='checkSkillEnabled"+r+"'><label class='custom-control-label unselectable' for='checkSkillEnabled"+r+"'>Active</label></div>",A=o.getMaxLevel(),y=o.getLevel(),E="",x="";1==A&&(x="disabled");for(let C,P=0;P<A;P++)C="",y-1==P&&(C="selected"),E+="<option "+C+">"+(P+1)+"</option>";E="<div><select class='sel-skill-level' "+x+">"+E,E+="</select></div>";let L="<div class='skill-entry-icon'><img class='unselectable' width='65' src='"+pathSkillIcon(o.getIcon())+"' /></div>",D="";if((o.hasStacks()||o.hasModes())&&(D+="<div class='stacks-modes'>"),o.hasStacks()){let P="";for(let N,C=0;C<=o.getMaxStacks();C++)N="",o.getStacks()==C&&(N="selected"),P+="<option "+N+">"+C+"</option>";D+="<div>Stacks:</div><select class='sel-skill-stacks "+x+"'>"+P+"</select>"}if(o.hasModes()){let P="",C=o.getModes();for(let N=0;N<C.length;N++){let _=C[N],B="";o.getMode()==_&&(B="selected"),P+="<option "+B+">"+_+"</option>"}D+="<select class='sel-skill-mode "+x+"'>"+P+"</select>"}(o.hasStacks()||o.hasModes())&&(D+="</div>"),o.hasStacks()||o.hasModes()||(D+="<div class='stacks-modes'></div>");let R="<div class='skill-entry-desc'><div class='skill-desc-title'>"+o.getName()+"</div><div class='skill-desc-text'>"+o.getDescription()+"</div></div>",T=I+D+E+L+R;return"<div class='skill-entry' data-sidx='"+r+"'>"+T+"</div>"}DATABASE_PATH="../data/aldb.json",SHIP_DATABASE={},SHIP_LB_DATABASE={},SHIP_RETRO_DATABASE={},MODIFIERS_DATABASE={},EQUIPS_DATABASE={},WEAPONS_DATABASE={},AIRCRAFT_DATABASE={},BULLETS_DATABASE={},ENEMIES_DATABASE={},BULLETS_INSTANCE_DB={},WEAPON_MAP={},EQUIPMENT_MAP={},ITEM_MAPS={},SKILL_DATABASE={},SKILL_EFFECTS={},MAP_DATABASE={},CHAPTER_MAP={},ENEMIES_DATABASE={};function loadJsonDBs(){var r=$.getJSON(DATABASE_PATH,function(o){SHIP_DATABASE=o.s,SHIP_LB_DATABASE=o.slb,SHIP_RETRO_DATABASE=o.sr,MODIFIERS_DATABASE=o.mod,EQUIPS_DATABASE=o.eq,WEAPONS_DATABASE=o.w,BULLETS_DATABASE=o.b,AIRCRAFT_DATABASE=o.air,ITEM_MAPS=o.im,SKILL_DATABASE=o.sk,SKILL_EFFECTS=o.se});return r.then(function(){let g=Object.keys(BULLETS_DATABASE);for(let S,h=0;h<g.length;h++)S=g[h],BULLETS_INSTANCE_DB[S]=new Bullet(S)}),Promise.all([r])}function loadSkill(r){return r in SKILL_DATABASE?SKILL_DATABASE[r]:(console.log("No skill with id "+r),null)}function loadShipBasic(r){return r in SHIP_DATABASE?SHIP_DATABASE[r]:(console.log("No ship with id "+r),null)}function loadShipLbInfo(r){return r in SHIP_LB_DATABASE?SHIP_LB_DATABASE[r]:(console.log("No ship in LB database with id "+r),null)}function loadShipBasic(r){return r in SHIP_DATABASE?SHIP_DATABASE[r]:(console.log("No ship with id "+r),null)}function loadShipRetro(r){return r in SHIP_RETRO_DATABASE?SHIP_RETRO_DATABASE[r]:(console.log("No ship retrofit with id "+r),null)}function loadEnemy(r){if(!(r in ENEMIES_DATABASE))return console.log("No enemy with id "+r),null;let o=ENEMIES_DATABASE[r],g=null;if("base"in o){let h=o.base;g=ENEMIES_DATABASE[h]}return{base:g,enemy:o}}function loadEquipData(r){return r in EQUIPS_DATABASE?EQUIPS_DATABASE[r]:(console.log("No equip with id "+r),null)}function loadWeaponData(r){return r in WEAPONS_DATABASE?WEAPONS_DATABASE[r]:(console.log("No weapon with id "+r),null)}function loadBulletData(r){return r in BULLETS_DATABASE?BULLETS_DATABASE[r]:(console.log("No bullet with id "+r),null)}function loadAircraftData(r){return r in AIRCRAFT_DATABASE?AIRCRAFT_DATABASE[r]:(console.log("No aircraft with id "+r),null)}function dbLoadEquipMap(r){if(!(r in ITEM_MAPS.equipMap))return console.log("No equip with id "+r),null;let o=ITEM_MAPS.equipMap[r];return{id:r,base:o.b,upgrade:o.u}}function dbLoadWeaponMap(r){if(!(r in ITEM_MAPS.weaponMap))return console.log("No weapon with id "+r),null;let o=ITEM_MAPS.weaponMap[r];return{id:r,base:o.b,upgrade:parseInt(o.u)}}function dbLoadAircraftMap(r){if(!(r in ITEM_MAPS.aircraftMap))return console.log("No aircraft with id "+r),null;let o=ITEM_MAPS.aircraftMap[r];return{id:r,base:o.b,upgrade:parseInt(o.u)}}function isAircraft(r){return r in ITEM_MAPS.aircraftMap}function loadSkillEffect(r){return r in SKILL_EFFECTS?SKILL_EFFECTS[r]:null}var TOP_PANEL=null,CALLBACK_MANAGER=null,SIM_STATE=null,SHIP_SEL_DROP=null,STATS_PANEL=null,EQUIP_SLOTS=null,COMBAT_SHIP_SEL_DROP=null,EQUIP_SEL_DROP=null,COMBAT_MAIN_UI=null,CURR_ENEMIES=[],SKILL_MANAGER=null,PANEL_MANAGER=null;function initAldb(){PANEL_MANAGER=new PanelManager;var r=new ShipInfoPanel(EPanels.SHIPINFO),o=new CombatPanel(EPanels.COMBAT);PANEL_MANAGER.addPanel(r),PANEL_MANAGER.addPanel(o),$("#main-container").hide();var g=loadJsonDBs();g.then(function(){initPropsMeta(),SIM_STATE=new SimState,TOP_PANEL=new TopPanel,CALLBACK_MANAGER=new CallbackManager,SKILL_MANAGER=new SkillManager,EQUIP_SLOTS=new EquipSlots,SHIP_SEL_DROP=new ShipSelDrop,STATS_PANEL=new StatsPanel,COMBAT_SHIP_SEL_DROP=new CShipSelDrop,EQUIP_SEL_DROP=new EquipSelDrop,COMBAT_MAIN_UI=new CombatMainUI,setModalCallbacks(),CALLBACK_MANAGER.register(ECallbackTypes.ADD_SHIP,function(){updateSelShipCombatStats()}),CALLBACK_MANAGER.register(ECallbackTypes.REM_SHIP,function(){updateSelShipCombatStats()}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_SHIP,function(){updateSelShipCombatStats()}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_FORM,function(){updateSelShipCombatStats()}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_AMMO,function(){updateSelShipCombatStats()}),CALLBACK_MANAGER.register(ECallbackTypes.SEL_SHIP,function(){updateSelShipCombatStats()}),TOP_PANEL.setCallbacks(),SIM_STATE.setCallbacks(),SHIP_SEL_DROP.setCallbacks(),STATS_PANEL.setCallbacks(),COMBAT_SHIP_SEL_DROP.setCallbacks(),EQUIP_SEL_DROP.setCallbacks(),COMBAT_MAIN_UI.setCallbacks(),$(".eq-upg-sel").change(function(){let S=SHIP_SEL_DROP.selShip,I=parseInt($(this).val()),A=$(this).parent().parent().parent().parent().parent().attr("slot"),y=S.slots[A-1];y.setUpgrade(I),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{ship:S,slot:S.fleetSlot,type:EShipUpdateFlag.UPD_EQ,eqSlot:A-1,eq:y.getEquipment()})}),$("#checkCombatStats").change(function(){let S=SHIP_SEL_DROP.selShip,I=this.checked,A=EStatsPanelMode.SHIP_INFO;I&&(A=EStatsPanelMode.FULL_STATS),STATS_PANEL.mode=A,S&&CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{ship:S,slot:S.fleetSlot,type:EShipUpdateFlag.UPD_STATS})}),$("#btnSearchEnemies").click(function(){let S=$("#selChapter").val(),I=$("#selMap").val(),A=MAP_DATABASE[I+"0"+S],y=A.enemies;CURR_ENEMIES=[];for(let E=0;E<y.length;E++){let x=y[E],L=new Enemy(x.enemy,x.lvl);CURR_ENEMIES.push(L)}CURR_ENEMIES.sort(function(E,x){return x.getStat(EAttributes.DURABILITY)-E.getStat(EAttributes.DURABILITY)}),$("#contEnemyLst").children().remove().end();for(let E=0;E<CURR_ENEMIES.length;E++){let x=CURR_ENEMIES[E],L=buildEnemyEntryHtml(x);$("#contEnemyLst").append(L)}console.log(CURR_ENEMIES)})}).then(function(){$(".menu-shipInfo").click(function(){PANEL_MANAGER.setActive(0)}),$(".menu-combat").click(function(){PANEL_MANAGER.setActive(1)}),$("#loading").hide(),$("#main-container").fadeIn()})}var DEFAULT_LB=3,DEFAULT_LEVEL=100,DEFAULT_AFFECTION=100,DEFAULT_RINGED=!1,DEFAULT_AFFIDX=3,DEFAULT_UPGRADE=10,PR_MAX_BPS=343,PR_MAX_DEV_LVL=30,PR_EXP_BP=10;class EquipSlot{constructor(r,o,g){this.data=g,this.slotNo=o,this.ship=r,this.typeMask=g.type,this.eff=g.eff,this.stats=[];for(let h=0;h<NUM_ATTRS;h++)this.stats[h]=0;this.mount=0,"mount"in g&&(this.mount=g.mount),this.preload=0,"preload"in g&&(this.preload=g.preload),this.eq=null,this.default=null,"default"in g&&(this.default=g["default"],this.setEquipment(this.default))}refresh(r){this.typeMask=r.type,this.eff=r.eff,"mount"in r&&(this.mount=r.mount),"preload"in r&&(this.preload=r.preload),"default"in r&&(this.default=r["default"])}setEquipment(r){let o=createEquipment(r,r==this.default,this.typeMask);this.validate(o)&&(this.eq=o,this.stats=this.eq.getStats())}getEquipment(){return this.eq}addEfficiency(r){this.eff=this.data.eff+r}removeEquip(){if(this.eq=null,this.default)this.eq=createEquipment(this.default,!0,this.typeMask),this.stats=this.eq.getStats();else{this.stats=[];for(let r=0;r<NUM_ATTRS;r++)this.stats[r]=0}}hasStats(){return this.eq.hasStats()}getStats(){return this.stats}calcGearScore(){if(this.eq&&!this.isDefault()){let r=DGearScore[this.eq.stars],o=r.base,g=r.bonus;return o+(this.eq.getUpgrade()+1)*g}return 0}isDefault(){return null!=this.default&&this.eq&&this.eq.id==this.default}getEfficiency(){return this.eff}validate(r){return!!r&&(r.isDefault()?r.getUpgId()==this.default:0!=(this.typeMask&r.type)&&0==(r.forbiddenMask&this.ship.type))}isType(r){return 0!=(this.typeMask&r)}setUpgrade(r){this.eq&&this.eq.setUpgrade(r),this.stats=this.eq.getStats(),this.ship.refreshStats()}getUpgrade(){return this.eq?this.eq.getUpgrade():0}getEquipName(){return this.eq?this.eq.name:""}getMountNo(){return this.mount}getPreloadNo(){return this.preload}getDescs(){if(this.eq){let r=this.eq.descs.slice(0);return this.eq.isWeapon()&&r.push({name:"Rof",val:this.getReloadPanel()+" s"}),r}return[]}getUpgList(){return this.eq?this.eq.getUpgList():[]}getIcon(){return this.eq?this.eq.getIcon():null}getStars(){return this.eq?this.eq.getStars():null}isWeapon(){return this.eq&&this.eq.isWeapon()}getReload(){return calcReloadForGun(this.ship.getCombatStat(EAttributes.RELOAD),this.eq)}getReloadPanel(){let r=0;return r=STATS_PANEL.mode==EStatsPanelMode.FULL_STATS?this.ship.getCombatStat(EAttributes.RELOAD):this.ship.getFullStat(EAttributes.RELOAD),calcReloadForGun(r,this.eq)}getSlotNo(){return this.slotNo}isEquipSlot(){return!0}}class Ship{constructor(r,o){this.id=r,this.retrofit=o,o||(this.retrofit=!1),this.fleetSlot=-1,this.stats=[],this.attrs=[],this.attrsGrowth=[],this.attrsExtra=[],this.attrsEnMax=[],this.retroStats=[],this.enStats=[];for(let g=0;g<NUM_ATTRS;g++)this.attrs[g]=0,this.attrsGrowth[g]=0,this.attrsExtra[g]=0,this.attrsEnMax[g]=0,this.stats[g]=0,this.retroStats[g]=0,this.enStats[g]=0;return this.fixedAmmo=[null,null,null,null,null,null],this.fixedMods=[null,null,null,null,null,null],this.reloadReqs={},this.slots=[null,null,null,null,null],this.hiddenGun=null,this.data=this.loadShipFunction(r),this.lbData=this.loadShipLbInfoFunction(r),null==this.data||null==this.lbData?void console.log("Error instantiating ship with id "+r):void(this.jpName=this.data.jpName,this.enName=this.data.enName,this.groupId=this.data.groupId,this.rarity=this.data.rarity,this.type=this.data.shipType,this.icon=this.id,this.nation=this.data.nation,this.hasRetro=!1,"hasRetrofit"in this.data&&(this.hasRetro=this.data.hasRetrofit),this.lbIds=[],"shipIds"in this.data&&(this.lbIds=this.data.shipIds),this.level=DEFAULT_LEVEL,this.lb=DEFAULT_LB,this.aff=DEFAULT_AFFECTION,this.ringed=DEFAULT_RINGED,this.affIdx=DEFAULT_AFFIDX,this.retrofit?this.setLimitBreak(3):this.setLimitBreak(this.lb),this.calcGearStats())}loadShipFunction(r){return loadShipBasic(r)}loadShipLbInfoFunction(r){return loadShipLbInfo(r)}getLbData(r){return this.lbData.lbInfo[r]}getId(){return this.id}hasHiddenGun(){return"hiddenGun"in this.getLbData(this.lb)}getName(){return this.enName}getIcon(){return this.icon}setAffectionLevel(r){if(0<=r&&5>=r){let o=DAffectionLevels.stats[r];this.aff=o.affection,this.ringed=o.ringed,this.affIdx=r,this.refreshStats()}}setAffection(r){return 0>r||200<r?void console.log("Invalid affection value."):void(this.aff=r,this.refreshStats())}getLevel(){return this.level}setLevel(r){return 0>=r||120<r?void console.log("Invalid level value."):void(this.level=r,this.refreshStats())}setLimitBreak(r){if(this.retrofit||r in this.lbData.lbInfo||console.log("No limit break "+r+" for ship "+this.id),this.lb=r,!this.isPriority()){let g=DLBLimits[this.lb];this.level>g.maxLvl?this.setLevel(g.maxLvl):this.level<g.minLvl&&this.setLevel(g.minLvl)}let o=this.getLbData(r);if(this.tmpId=o.shipId,this.attrs=o.attrs,this.attrsGrowth=o.attGrowth,this.attrsExtra=o.attExtra,this.attrsEnMax=o.attrEnMax,this.oilStart=o.oilStart,this.oilEnd=o.oilEnd,this.armorType=o.armorType,this.stars=o.stars,this.tagList=o.tagList,this.loadSkills(),this.calcStats(),this.alreadyLoadedEq?this.reloadEquipSlots():this.loadEquipSlots(),this.hasHiddenGun()){let g={"default":o.hiddenGun,type:1,eff:o.hiddenGunEff};this.hiddenGun=new EquipSlot(this,6,g)}this.fullStats=this.calcFullStats(),this.combatStats=this.calcFullStats()}loadSkills(){let r=this.getLbData(this.lb);this.hasBarrage=!1,this.skillData=[],this.skills=[],this.barrages=[],"skills"in r&&(this.skillData=r.skills);for(let o=0;o<this.skillData.length;o++)if(this.skillData[o].isUnlocked){let ee=new Skill(this.skillData[o].id,null,this);ee.isBarrage&&(this.hasBarrage=!0,this.barrages.push(new Barrage(ee))),this.skills.push(ee)}}getBarrages(){return this.barrages}getSkills(){return this.skills}getEquipSkills(){let r=[];for(let o=0;5>o;o++)if(this.slots[o]){let g=this.slots[o].getEquipment();if(g){let h=g.getSkills();for(let S=0;S<h.length;S++)h[S].setOwner(this),r.push(h[S])}}return r}reloadEquipSlots(){let r=this.slots,o=this.getLbData(this.lb).slots;for(let g=0;5>g;g++)this.slots[g]&&this.slots[g].refresh(o[g]),r[g]&&!this.slots[g].validate(r[g].eq)&&(this.slots[g]=new EquipSlot(this,g+1,o[g]))}loadEquipSlots(){let r=this.getLbData(this.lb).slots;for(let o=0;5>o;o++)this.slots[o]=new EquipSlot(this,o+1,r[o]);this.alreadyLoadedEq=!0}setEquipment(r,o){this.slots[r-1].setEquipment(o),this.refreshStats()}removeEquipment(r){this.slots[r-1].removeEquip(),this.refreshStats()}updateEnhanceStats(){for(let r=0;r<NUM_ATTRS;r++)this.enStats[r]=calcEnhance(this.level,this.attrsEnMax[r])}calcEnhancedStat(r,o){return calcEnhance(r,o)}calcStats(){for(let o=0;o<NUM_ATTRS;o++)this.stats[o]=calcStat(this.level,this.attrs[o],this.attrsGrowth[o],this.attrsExtra[o])+this.calcEnhancedStat(this.level,this.attrsEnMax[o],o);let r=getIntimacyMult(this.aff,this.ringed);this.stats[EAttributes.DURABILITY]=Math.floor(this.stats[EAttributes.DURABILITY]*r),this.stats[EAttributes.CANNON]=Math.floor(this.stats[EAttributes.CANNON]*r),this.stats[EAttributes.TORP]=Math.floor(this.stats[EAttributes.TORP]*r),this.stats[EAttributes.AA]=Math.floor(this.stats[EAttributes.AA]*r),this.stats[EAttributes.AIR]=Math.floor(this.stats[EAttributes.AIR]*r),this.stats[EAttributes.ANTISUB]=Math.floor(this.stats[EAttributes.ANTISUB]*r),this.stats[EAttributes.RELOAD]=Math.floor(this.stats[EAttributes.RELOAD]*r),this.stats[EAttributes.HIT]=Math.floor(this.stats[EAttributes.HIT]*r),this.stats[EAttributes.EVA]=Math.floor(this.stats[EAttributes.EVA]*r);for(let o=0;o<NUM_ATTRS;o++)this.stats[o]+=this.retroStats[o]}getArmor(){return this.armorType}getType(){return this.type}getNation(){return this.nation}getFullStat(r){return this.fullStats[r]}getFullStats(){return this.fullStats}getCombatStat(r){return this.combatStats[r]}getCombatStats(){return this.combatStats}getStat(r){return this.stats[r]}getFixedAmmo(r){return 1>r||6<r?null:this.fixedAmmo[r-1]}setFixedAmmo(r,o){this.fixedAmmo[r-1]=o}getFixedMods(r){return 1>r||6<r?null:this.fixedMods[r-1]}setFixedMods(r,o){this.fixedMods[r-1]=o}setReloadReq(r,o){r in this.reloadReqs?this.reloadReqs[r]+=o:this.reloadReqs[r]=o}getReloadReq(r){return r in this.reloadReqs?this.reloadReqs[r]:0}clearModsReqs(){this.reloadReqs={},this.fixedMods=[null,null,null,null,null,null],this.fixedAmmo=[null,null,null,null,null,null]}getCombatStats(){return this.combatStats}addStatBuffs(r,o){this.combatStats=this.calcFullStats();for(let g=0;g<NUM_ATTRS;g++)o&&(this.combatStats[g]+=o[g]),r&&(this.combatStats[g]=Math.floor(this.combatStats[g]*(1+r[g])))}addEfficiencies(r){for(let g,o=0;3>o;o++)g=this.slots[o],g.addEfficiency(r[o+1]);this.hiddenGun&&this.hiddenGun.addEfficiency(r[6])}getCost(){return calcOilConsumption(this)}calcGearScore(){let r=0;for(let o=0;6>o;o++)null==this.slots[o]||this.slots[o].isDefault()||(r+=this.slots[o].calcGearScore());return r}calcGearStats(){this.gearStats=[];for(let r=0;r<NUM_ATTRS;r++)this.gearStats[r]=0;for(let r=0;5>r;r++)if(this.slots[r]){let o=this.slots[r].getStats();for(let g=0;g<NUM_ATTRS;g++)this.gearStats[g]+=o[g]}return this.gearStats}calcFullStats(){let r=[],o=this.calcGearStats();for(let g=0;g<NUM_ATTRS;g++)r[g]=this.stats[g]+o[g];return r}calcRetroScore(){return 0}calcCombatPower(){let r=this.calcFullStats(),o=r[EAttributes.DURABILITY]/5+r[EAttributes.CANNON]+r[EAttributes.TORP]+r[EAttributes.AA]+r[EAttributes.AIR]+r[EAttributes.ANTISUB]+r[EAttributes.RELOAD]+2*r[EAttributes.HIT]+2*r[EAttributes.EVA]+r[EAttributes.SPEED],g=this.calcGearScore(),h=this.calcRetroScore();return Math.floor(o+g+h)}isType(r){return 0!=(this.type&r)}refreshStats(){this.calcStats(),this.fullStats=this.calcFullStats(),this.combatStats=this.calcFullStats()}isRetrofit(){return!1}getSlots(){return this.slots}getHiddenGun(){return this.hiddenGun}isVanguard(){return 0!=(EClass.FRONTLINE&this.type)}isMainFleet(){return 0!=(EClass.BACKLINE&this.type)}isFlagship(){return 1==this.fleetSlot}isLeader(){return 4==this.fleetSlot}isEnemy(){return!1}getTagList(){return this.tagList}getTemplId(){return this.tmpId}isPriority(){return!1}}class ShipRetrofit extends Ship{constructor(r){super(r,!0),this.retroData=loadShipRetro(r).retroInfo;let o=this.retroData.nodeList,g=1;for(let h=0;h<o.length;h++)g=Math.max(g,o[h].levelLimit);this.minLevel=g,this.maxLevel=120,this.lb=3,this.icon="r"+this.icon,this.totalGearScore=this.retroData.totalGearScore,this.retroStats=this.retroData.attrsTotal,this.refreshStats()}setLevel(r){return r<=this.minLevel-1||120<r?void console.log("Invalid level value."):void super.setLevel(r)}loadShipFunction(r){return loadShipRetro(r)}loadShipLbInfoFunction(r){return loadShipRetro(r).lbInfo}getLbData(){return this.lbData}calcRetroScore(){return this.totalGearScore}isRetrofit(){return!0}}class PriorityShip extends Ship{constructor(r){super(r,!1),this.devLvl=0,this.numBps=0,this.baseBps=0,this.exp=0,this.minLevel=0,this.maxLevel=120,this.needExp=0,this.needBps=0,this.prData=this.lbData.prData,this.lb=0,this.setDevLvl(30)}getDevLevel(){return this.devLvl}getCurrBps(){return this.numBps}getBaseBps(){return this.baseBps}setBps(r){this.numBps=Math.max(0,Math.min(r,PR_MAX_BPS)),this.exp=numBps*PR_EXP_BP,this.devLvl=this.getDevLvForExp(exp);let o=this.getDataForDevLvl(this.devLvl);o&&(this.baseBps=o.totalExp/PR_EXP_BP),this.setPrData(o)}setDevLvl(r){this.devLvl=Math.max(0,Math.min(r,PR_MAX_DEV_LVL));let o=this.getDataForDevLvl(this.devLvl);o&&(this.numBps=o.totalExp/PR_EXP_BP,this.baseBps=this.numBps,this.exp=o.totalExp),this.setPrData(o)}setPrData(r){if(r){this.minLevel=r.needLv;let o=this.getLevel();o=Math.max(this.minLevel,o),o!=this.getLevel()&&this.setLevel(o),this.setLimitBreak(DPrDevToLB[this.devLvl]);for(let S,h=0;3>h;h++)S=this.slots[h],this.isType(EClass.BATTLESHIP)&&0==h||(S.mount=r.mounts[h]),S.preload=r.preloads[h],S.eff+=r.profBonus[h];this.needExp=0;let g=this.getDataForDevLvl(this.devlLvl+1);g&&(this.needExp=g.needExp,this.needBps=dataNextLvl.totalExp-this.exp)}}getNeedBPs(){return this.needBps}getMaxNeedBPs(){return this.needExp/PR_EXP_BP}getDataForDevLvl(r){return!this.prData||0==r||r>PR_MAX_DEV_LVL?null:this.prData.lvs[r-1]}getDevLvForExp(r){if(!this.prData)return 0;let o=this.prData.lvs,g=0;for(let h=0;h<o.length;h++){if(r>o[h].totalExp)return g;g=o[h].lv}return g}isMaxDevLvl(){return this.devLvl==PR_MAX_DEV_LVL}calcEnhancedStat(r,o,g){let h=this.getDataForDevLvl(this.devLvl);if(!h)return 0;let S=Math.floor(h.accEffect[g]/100),I=0;if(!this.isMaxDevLvl()){let A=this.getDataForDevLvl(this.devLvl+1),y=A.totalExp-this.exp,E=y/A.needExp;I=E*A.effect[g]}return S+Math.floor(I/100)+Math.floor((S%100+I%100)/100)+h.attrBonus[g]}setLevel(r){super.setLevel(r);let o=this.getLevel();10>o&&10<=this.devLvl?this.setBps(36):30>o&&20<=this.devLvl?this.setBps(132):70>o&&30==this.devLvl&&this.setBps(341)}isPriority(){return!0}}class Fleet{constructor(){this.fleet=[null,null,null,null,null,null]}addShip(r,o){null!=this.fleet[r]&&removeShip(r),o.fleetSlot=r,this.fleet[r]=o}removeShip(r){this.fleet[r]=null}getShip(r){return this.fleet[r]}getFleetStats(){let r=[];for(let o=0;o<NUM_ATTRS;o++)r[o]=0;for(let o=0;o<this.fleet.length;o++)if(null!=this.fleet[o])for(let g=0;g<NUM_ATTRS;g++)r[g]+=this.fleet[o].getFullStat(g);return r}getFleetCost(){let r=0;for(let o=0;o<this.fleet.length;o++)null!=this.fleet[o]&&(r+=this.fleet[o].getCost());return r}getFrontlinePower(){let r=0;for(let o=0;3>o;o++)null!=this.fleet[o+3]&&(r+=this.fleet[o+3].calcCombatPower());return r}getBacklinePower(){let r=0;for(let o=0;3>o;o++)null!=this.fleet[o]&&(r+=this.fleet[o].calcCombatPower());return r}getFrontline(){let r=[];for(let o=0;3>o;o++)this.fleet[o+3]&&r.push(this.fleet[o+3]);return r}getBackline(){let r=[];for(let o=0;3>o;o++)this.fleet[o]&&r.push(this.fleet[o]);return r}getShips(){let r=[];for(let o=0;o<this.fleet.length;o++)this.fleet[o]&&r.push(this.fleet[o]);return r}refreshAAStats(){let r=0,o=0,g=0;for(let S,h=0;h<this.fleet.length;h++)if(S=this.fleet[h],S){let te=S.getSlots();for(let se,ae=0;ae<te.length;ae++)se=te[ae],se.isType(EGunType.ANTIAIR_GUN)&&(g+=se.getMountNo(),r+=se.getMountNo()*se.getEquipment().getRange(),o+=se.getMountNo()*se.getReload())}this.aaRange=0,this.aaRof=0,0<g&&(this.aaRange=r/g,this.aaRof=o/g+0.5)}refreshAmbushStats(r){let o=0,g=0;for(let I,S=0;S<this.fleet.length;S++)if(I=this.fleet[S],I){let le=I.getFullStats();o+=le[EAttributes.AIR],g+=le[EAttributes.EVA]}this.reconValue=Math.floor(Math.pow(g+o,2/3));let h=Math.pow(g,2/3);this.ambushAvoidRate=h/(h+r.mapAvoidValue)+r.ambushBonus}}var rarityToClass={1:"common",2:"rare",4:"srare",8:"ssrare",16:"urare",32:"ssrare"},rarityToClassStars={1:"n",2:"sr",4:"sr",8:"ssr",16:"ur",32:"ssr"},ShipRarityToIcon={1:"common",2:"rare",4:"sr",8:"ssr",16:"ur",32:"ssr"},EqRarityToClass={1:"common",2:"common",3:"rare",4:"srare",5:"ssrare",6:"urare"},EqRarityToImg={1:"common",2:"common",3:"rare",4:"sr",5:"ssr",6:"ur"},EShipTypesIcon={1:"1",2:"1",4:"8",8:"8",16:"2",32:"8",64:"6",128:"5",256:"4",512:"9",1024:"3"},ECallbackTypes={ADD_SHIP:1,REM_SHIP:2,UPD_SHIP:4,UPD_FORM:8,UPD_AMMO:16,SEL_SHIP:32,SEL_SHIP_COMBAT:64},DAmmoToName={1:"Normal",2:"AP",3:"HE"},DGunAttrSort={damage:1,Rof:2,cannon:9,dodge:10,torpedo:9,durability:10,reload:10,antiaircraft:10,air:9,luck:10,hit:10},EShipUpdateFlag={UPD_LB:1,UPD_LVL:2,UPD_AFF:4,UPD_EQ:8,UPD_STATS:16,UPD_SKILL:32,UPD_SEL:64,UPD_BARRAGES:97},EPanels={SHIPINFO:1,COMBAT:2};function isUpdateType(r,o){return r&&0!=(r&o)}class CallbackManager{constructor(){this.callbackRouter={}}activateCallbacks(r,o){if(r in this.callbackRouter)for(let g=0;g<this.callbackRouter[r].length;g++)this.callbackRouter[r][g](o)}register(r,o){r in this.callbackRouter||(this.callbackRouter[r]=[]),this.callbackRouter[r].push(o)}}class Panel{constructor(r,o){this.name=r,this.id=o,this.isActive=!1}update(){}}class CombatPanel extends Panel{constructor(r){super("Combat",r),this.html=$("#combat-panel")}hide(){$(this.html).hide(),this.isActive=!1}show(){this.update(),$(this.html).fadeIn(),this.isActive=!0}update(){}setCallBacks(){}}class ShipInfoPanel extends Panel{constructor(r){super("Ship Info",r),this.html=$("#shipInfo-panel")}hide(){$(this.html).hide(),this.isActive=!1}show(){this.update(),$(this.html).fadeIn(),this.isActive=!0}update(){}setCallBacks(){}}class PanelManager{constructor(){this.panels=[],this.activePanel=null}setActive(r){0<=r&&r<this.panels.length&&(!this.activePanel||this.panels[r].id!=this.activePanel.id)&&(this.activePanel&&this.activePanel.hide(),this.activePanel=this.panels[r],this.activePanel.show())}addPanel(r){this.panels.push(r)}isPanelActive(r){return this.activePanel.id==r}}class EquipSlots{constructor(){let r=$("#eq-slots-cont-1"),o=$("#eq-slots-cont-2");this.slots=[];let g=$(r).find(".equip-slot");for(let S=0;S<g.length;S++)this.slots.push(g[S]);let h=$(o).find(".equip-slot");for(let S=0;S<h.length;S++)this.slots.push(h[S]);this.slotsSel=[null,null,null,null,null,null];for(let I,S=0;S<this.slots.length;S++)I=$(this.slots[S]).find(".eqttip"),I&&(this.slotsSel[S]=I)}update(r,o){if(!r){for(let h=0;5>h;h++)$(this.slotsSel[h]).data("shiptype",0),$(this.slotsSel[h]).data("type",0);return void $(this.slots[5]).hide()}let g=r.slots;for(let S,h=0;h<g.length;h++)if(S=g[h],S){$(this.slotsSel[h]).data("shiptype",r.type),$(this.slotsSel[h]).data("type",S.typeMask);let I="";if(S.typeMask in EGunType.props?I=EGunType.props[S.typeMask].code:0!=(EGunType.AUX_EQ&S.typeMask)&&(I="Aux"),!isUpdateType(o,EShipUpdateFlag.UPD_LVL|EShipUpdateFlag.UPD_AFF|EShipUpdateFlag.UPD_SKILL)){$(this.slots[h]).find(".equip-slot-name").text(I),S.isWeapon()?($(this.slots[h]).find(".mount-val").text(S.getMountNo()),$(this.slots[h]).find(".preload-val").text(S.getPreloadNo()),$(this.slots[h]).find(".pre-mount-tbl-body").show(),$(this.slots[h]).find(".equip-eff").show(),$(this.slots[h]).find(".slot-eff").text(Math.round(100*S.eff)+"%")):($(this.slots[h]).find(".equip-eff").hide(),$(this.slots[h]).find(".pre-mount-tbl-body").hide());let y=$(this.slots[h]).find(".eq-upg-sel");if(S.isDefault())y.children().remove().end(),y.append("<option selected>"+parseInt(S.getUpgrade())+"</option>"),y.attr("disabled",!0);else{let R=S.getUpgList();y.children().remove().end();for(let P,T=0;T<R.length;T++)P="",S.getUpgrade()==R[T]&&(P="selected"),y.append("<option "+P+" value='"+parseInt(R[T])+"'>"+parseInt(R[T])+"</option>");y.removeAttr("disabled")}let E=$(this.slots[h]).find(".eq-ammo-prop");E.children().remove().end();let x=null,L=r.getFixedAmmo(S.slotNo);L?x=L.getAmmoType():S.eq&&(x=S.eq.getAmmoType()),S.eq&&x&&3>=x&&1<=x&&E.append("<img title='"+DAmmoToName[x]+"' src='img/at-"+x+".png' />"),$(this.slots[h]).find(".eq-name").text(S.getEquipName());let D=S.getIcon();if(D&&"1"!=D&&S.getStars()){let R=pathEquipIcon(D,!0);$(this.slotsSel[h]).css("background","url("+R+") center no-repeat, url(../img/bgs/"+EqRarityToImg[S.getStars()]+".png) center no-repeat"),$(this.slotsSel[h]).css("background-size","cover"),$(this.slotsSel[h]).find(".imgstars").show(),$(this.slotsSel[h]).find(".imgstars").attr("src","img/stars/"+S.getStars()+".png")}else $(this.slotsSel[h]).css("background","url(../img/btn-add.png) center no-repeat"),$(this.slotsSel[h]).css("background-size","cover"),$(this.slotsSel[h]).find(".imgstars").hide()}let A=$(this.slots[h]).find(".eq-desc-cont");A.children().remove().end(),A.append(convertDescsToCtrls(S.getDescs().sort(function(y,E){return DGunAttrSort[y.name]-DGunAttrSort[E.name]})))}if(r.hasHiddenGun()){$(this.slots[5]).show();let h=r.hiddenGun;if(!isUpdateType(o,EShipUpdateFlag.UPD_LVL|EShipUpdateFlag.UPD_AFF|EShipUpdateFlag.UPD_SKILL)){$(this.slots[5]).find(".slot-eff").text(Math.round(100*h.eff)+"%");let I=$(this.slots[5]).find(".eq-upg-sel");if(h.isDefault())I.children().remove().end(),I.append("<option selected>"+parseInt(h.getUpgrade())+"</option>"),I.attr("disabled",!0);else{let E=h.getUpgList();I.children().remove().end();for(let L,x=0;x<E.length;x++)L="",h.getUpgrade()==E[x]&&(L="selected"),I.append("<option "+L+" value='"+parseInt(E[x])+"'>"+parseInt(E[x])+"</option>");I.removeAttr("disabled")}let A=$(this.slots[5]).find(".eq-ammo-prop");A.children().remove().end();let y=null;h.eq&&(y=h.eq.getAmmoType()),h.eq&&y&&3>=y&&1<=y&&A.append("<img title='"+DAmmoToName[y]+"' src='img/at-"+y+".png' />"),$(this.slots[5]).find(".eq-name").text(h.getEquipName()),$(this.slots[5]).find(".pre-mount-tbl-body").hide(),$(this.slotsSel[5]).find(".imgstars").hide(),$(this.slotsSel[5]).css("background","url(../img/no-img.png) center no-repeat"),$(this.slotsSel[5]).css("background-size","cover")}let S=$(this.slots[5]).find(".eq-desc-cont");S.children().remove().end(),S.append(convertDescsToCtrls(h.getDescs()))}else $(this.slots[5]).hide()}}var EStatsPanelMode={FULL_STATS:1,SHIP_INFO:2};class StatsPanel{constructor(){this.html=$(".shipInfo-statsPanel"),this.lbls=[],this.lbls.push($(this.html).find("div[title |= 'Health']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Firepower']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Torpedo']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Anti-air']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Air Power']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Reload']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Armor']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Hit']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Evasion']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Speed']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Luck']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Anti-Sub']").find("div[class = attrval]")),this.lbls.push($(this.html).find("div[title |= 'Cost']").find("div[class = attrval]")),this.divNormal=$("#divNormal"),this.lvlInput=$("#inLvl"),this.lbInput=$("#inLB"),this.affDrop=new TopDropDown("affection","affection-drop",ECallbackTypes.UPD_SHIP),this.divPrio=$("#divPrio"),this.devLvlInput=$("#inDev"),this.bpsInput=$("#inBps"),this.barrageInfo=$(".barrages"),this.barrageTabs=$("#barr-tabs"),this.mode=EStatsPanelMode.SHIP_INFO,this.barrages=[],this.currBarrage=null}updateBarrage(r,o){let g=$(r).find(".barrage-upg-sel");g.children().remove().end();let h=o.getMaxLevel(),S=o.getLevel();for(let y=0;y<h;y++){let E=y+1,x="";E==S&&(x="selected"),g.append("<option "+x+">"+E+"</option>")}$(r).find(".barrage-name").text(o.getName()),$(r).find(".barrage-info").children().remove().end();let I=o.getDescs();for(let y=0;y<I.length;y++)$(r).find(".barrage-info").append(buildBarrageWeaponHtml(I[y]));let A=$(r).find(".bskill-icon");A&&($(A).css("background","url("+pathSkillIcon(o.getIcon(),!0)+") center no-repeat"),$(A).css("background-size","cover"))}updateBarrages(){if($(this.barrageInfo).find(".barrage").remove().end(),$(this.barrageTabs).children().remove().end(),!(1>=this.barrages.length)){for(let r=0;r<this.barrages.length;r++){let o=this.barrages[r],g=buildBarrageTab(o,0==r),h=buildBarrageBody(o,0==r);$(this.barrageTabs).append(g),$(this.barrageInfo).append(h);let S=$(this.barrageInfo).find("#s"+o.getId());$(S).attr("data-idx",r),$(S).removeClass("barrage-single"),this.updateBarrage(S,o)}$(this.barrageTabs).show()}else if($(this.barrageTabs).hide(),0<this.barrages.length){let r=buildBarrageBody(this.barrages[0],!0);$(this.barrageInfo).append(r);let o=$(this.barrageInfo).find("#s"+this.barrages[0].getId());$(o).attr("data-idx",0),$(o).addClass("barrage-single"),this.updateBarrage(o,this.barrages[0])}$(".barrage-upg-sel").change(function(){let r=$(this).val(),o=$(this).parent().parent().parent().data("idx");STATS_PANEL.updateBarrageLvl(o,r);let g=SHIP_SEL_DROP.getSelShip();CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:g.fleetSlot,ship:g,type:EShipUpdateFlag.UPD_SKILL,skill:STATS_PANEL.currBarrage.getSkill()})})}updateBarrageLvl(r,o){if(!(0>=this.barrages.length)){let g=this.barrages[r],h=g.getId(),S=$(this.barrageInfo).find("#s"+h);g.setLevel(o),this.updateBarrage(S,g)}}refreshBarrages(){for(let o,r=0;r<this.barrages.length;r++){o=this.barrages[r],o.refresh();let g=o.getId(),h=$(this.barrageInfo).find("#s"+g);h&&this.updateBarrage(h,o)}}updateValues(r,o){if(r){let g=r.calcGearStats(),h=r.stats;this.mode==EStatsPanelMode.FULL_STATS&&(h=r.getCombatStats());for(let A=0;12>A;A++){$(this.lbls[A]).children().remove().end(),$(this.lbls[A]).text("");let y=Math.floor(h[A]);0<g[A]&&this.mode==EStatsPanelMode.SHIP_INFO&&(y+="<div style='display: inline-block; color: lawngreen;'>+"+g[A]+"</div>"),$(this.lbls[A]).append(y)}$(this.lbls[EAttributes.ARMOR]).text(EArmorType.props[r.armorType].code),$(this.lbls[12]).text(calcOilConsumption(r)),$(this.lvlInput).val()!=r.level&&$(this.lvlInput).val(r.level),$(this.lbInput).find("option").remove().end();let S=null;S=r.isRetrofit()?[3]:Object.keys(r.lbData.lbInfo);for(let A=0;A<S.length;A++)"retro"!=S[A]&&$(this.lbInput).append("<option value='"+S[A]+"'>"+S[A]+"</option>");if($(this.lbInput).val(r.lb),r.isPriority()?($(this.divNormal).hide(),$(this.divPrio).show(),$(this.devLvlInput).attr("max",30),$(this.devLvlInput).attr("min",0),$(this.devLvlInput).val(r.getDevLevel()),$(this.bpsInput).attr("max",r.getNeedBPs()),$(this.bpsInput).attr("min",0),$(this.bpsInput).val(r.getCurrBps()-r.getBaseBps())):($(this.divNormal).show(),$(this.divPrio).hide()),r.isRetrofit()||r.isPriority())$(this.lbInput).attr("disabled","True"),$(this.lvlInput).attr("max",r.maxLevel),$(this.lvlInput).attr("min",r.minLevel);else{$(this.lbInput).removeAttr("disabled");let A=DLBLimits[r.lb];$(this.lvlInput).attr("max",A.maxLvl),$(this.lvlInput).attr("min",A.minLvl)}this.affDrop.setValue(r.affIdx);let I=r.rarity;if(r.isRetrofit()&&(I/=2),$("#ship-stars").attr("src","img/stars-e/"+rarityToClassStars[I]+"-"+r.stars+"e.png"),$("#ship-cp").text(r.calcCombatPower()),$("#ship-type").attr("src","img/ship-types/"+EShipTypesIcon[r.type]+".png"),$("#ship-type").attr("title",EClass.props[r.type].name),$("#ship-type-name").text(EClass.props[r.type].name),r.isType(EClass.CARRIER_CLASS)){let A=0;STATS_PANEL.mode==EStatsPanelMode.FULL_STATS&&(A=r.getReloadReq("airAssist")),$("#ship-airstrike").text(((1+A)*calcAirstrikeReloadTwo(r,h[EAttributes.RELOAD])).toFixed(2)+" s"),$(".airstrike").show()}else $(".airstrike").hide();$(".shipInfo-main").show(),isUpdateType(o,EShipUpdateFlag.UPD_BARRAGES^EShipUpdateFlag.UPD_SKILL)?r.hasBarrage?(this.currBarrage=r.barrages[0],this.barrages=r.barrages,this.updateBarrages(),$(this.barrageInfo).show()):(this.currBarrage=null,$(this.barrageInfo).hide()):isUpdateType(o,EShipUpdateFlag.UPD_SKILL)&&this.refreshBarrages()}else{for(let g=0;12>g;g++)this.lbls[g].children().remove().end(),$(this.lbls[g]).text(0);$(this.lbls[EAttributes.ARMOR]).text("---"),$(this.lbls[12]).text(0),$(this.lvlInput).val(1),$("#inLB").find("option").remove().end(),this.affDrop.setValue(0),$("#ship-stars").attr("src","img/stars-e/n-1e.png"),$("#ship-cp").text(0),$(".airstrike").hide(),$(".shipInfo-main").hide()}}setCallbacks(){CALLBACK_MANAGER.register(ECallbackTypes.SEL_SHIP,function(r){STATS_PANEL.updateValues(r.ship,EShipUpdateFlag.UPD_SEL),EQUIP_SLOTS.update(r.ship,EShipUpdateFlag.UPD_SEL)}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_SHIP,function(r){SHIP_SEL_DROP.selShip&&SHIP_SEL_DROP.selShip.id==r.ship.id&&(STATS_PANEL.updateValues(r.ship,r.type),EQUIP_SLOTS.update(r.ship,r.type))}),$(this.lvlInput).click(function(){let r=SHIP_SEL_DROP.selShip;if(r){let o=parseInt($(this).val()),g=parseInt($(this).attr("max")),h=parseInt($(this).attr("min"));o<h?o=h:o>g&&(o=g),$(this).val(o),o!=r.level&&(SHIP_SEL_DROP.selShip.setLevel(o),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:r.fleetSlot,ship:r,type:EShipUpdateFlag.UPD_LVL}))}}),$(this.lvlInput).blur(function(){let r=SHIP_SEL_DROP.selShip;if(r){let o=parseInt($(this).val()),g=parseInt($(this).attr("max")),h=parseInt($(this).attr("min"));o<h?o=h:o>g&&(o=g),$(this).val(o),o!=r.level&&(SHIP_SEL_DROP.selShip.setLevel(o),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:r.fleetSlot,ship:r,type:EShipUpdateFlag.UPD_LVL}))}}),$(this.lbInput).change(function(){let r=SHIP_SEL_DROP.selShip;if(r){let o=$(this).val();SHIP_SEL_DROP.selShip.setLimitBreak(o),STATS_PANEL.updateValues(r),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:r.fleetSlot,ship:r,type:EShipUpdateFlag.UPD_LB})}}),$(this.devLvlInput).click(function(){let r=SHIP_SEL_DROP.selShip;if(r&&r.isPriority()){let o=$(this).val();r.setDevLvl(o),STATS_PANEL.updateValues(r),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:r.fleetSlot,ship:r,type:EShipUpdateFlag.UPD_LB})}}),$(this.bpsInput).click(function(){let r=SHIP_SEL_DROP.selShip;if(r&&r.isPriority()){let o=$(this).val();r.setBps(r.getBaseBps()+o),STATS_PANEL.updateValues(r),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:r.fleetSlot,ship:r,type:EShipUpdateFlag.UPD_LB})}}),$(".affection-option").click(function(){STATS_PANEL.updateAffection(this)})}updateAffection(r){let o=SHIP_SEL_DROP.selShip;if(o){this.affDrop.updateValue(r);let g=this.affDrop.getValue();o.setAffectionLevel(g),this.updateValues(o),this.affDrop.activateCallbacks({slot:o.fleetSlot,ship:o,type:EShipUpdateFlag.UPD_AFF})}}hide(){$(this.html).hide()}show(){$(this.html).show()}}class ShipSelDrop{constructor(){this.html=$(".ship-sel-drop"),this.content=$(this.html).find(".ship-drop-cont"),this.selHtml=$("#sel-ship-drop"),this.selected=-1,this.selShip=null}getSelected(){return this.selected}getSelShip(){return this.selShip}clear(){$(this.content).find("div").remove().end()}refresh(){this.clear();let r=SIM_STATE.getAllShips();for(let o=0;o<r.length;o++)this.addEntry(o,r[o]);if(-1!=this.selected&&this.selShip){let o=SIM_STATE.getShipAtSlot(this.selected);o||this.resetSelected()}this.setClickCallbacks()}addEntry(r,o){let g=$.parseHTML("<div class=\"dropdown-item ship-opt\" opt=\""+o.fleetSlot+"\"><div>"+o.enName+"</div></div>");$(g).css("background","url(../img/triggers/"+o.icon+".png) no-repeat"),$(g).css("background-size","contain"),$(g).css("background-color","#EEEEEE"),$(g).hover(function(){$(this).css("background-color","#CCCCCC")},function(){$(this).css("background-color","#EEEEEE")}),$(this.content).append(g)}select(r){if(this.getSelected()!=r){$(this.selHtml).attr("sel",r);let o=SIM_STATE.getShipAtSlot(r);$(this.selHtml).css("background","url(../img/triggers/"+o.icon+".png) no-repeat"),$(this.selHtml).css("background-size","contain"),$(this.selHtml).find("div").text(o.enName),this.selShip=o,this.selected=r,CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.SEL_SHIP,{ship:o})}}resetSelected(){$(this.selHtml).attr("sel",-1),$(this.selHtml).css("background","url(../img/triggers/-1.png) no-repeat"),$(this.selHtml).css("background-size","contain"),$(this.selHtml).find("div").text("Select ship"),this.selShip=null,this.selected=-1,CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.SEL_SHIP,{ship:null})}setClickCallbacks(){$(".ship-opt").click(function(){SHIP_SEL_DROP.select($(this).attr("opt"))})}setCallbacks(){CALLBACK_MANAGER.register(ECallbackTypes.ADD_SHIP,function(){SHIP_SEL_DROP.refresh()}),CALLBACK_MANAGER.register(ECallbackTypes.REM_SHIP,function(){SHIP_SEL_DROP.refresh()}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_SHIP,function(){SHIP_SEL_DROP.refresh()})}}class TopDropDown{constructor(r,o,g){this.name=r,this.id=o,this.html=$("#"+this.id),this.sel=$(this.html).attr("sel"),this.cb=g}updateValue(r){var o=$(r).attr("opt");o!=this.sel&&($("#sel-"+this.id).attr("src","img/misc/"+this.name+"-"+o+".png"),$("#"+this.id).attr("sel",o),this.sel=o)}setValue(r){var o=r;o!=this.sel&&($("#sel-"+this.id).attr("src","img/misc/"+this.name+"-"+o+".png"),$("#"+this.id).attr("sel",o),this.sel=o)}activateCallbacks(r){r?CALLBACK_MANAGER.activateCallbacks(this.cb,r):CALLBACK_MANAGER.activateCallbacks(this.cb)}getValue(){return this.sel}}var EFilterType={TEXT:0,BUTTON:1};class SlotFilter{constructor(){this.text="",this.nation=0,this.stype=0,this.rarity=0}setText(r){this.text=r}clearText(){this.text=0}clearAll(){this.text="",this.nation=0,this.stype=0,this.rarity=0}applyFilter(r,o){let g=$(r).children();for(let h=0;h<g.length;h++){let S=g[h],I=$(S).attr("iid"),A=$(S).data("retrofit");if(-1!=I){if(o&&o.includes(I)){$(S).css("display","none");continue}let y=null;y=A?SHIP_RETRO_DATABASE[I]:SHIP_DATABASE[I];let E=y.nation,x=y.shipType,L=y.rarity,D=y.enName,R=!1;0!=this.nation&&(R|=0==(this.nation&E)),0!=this.stype&&(R|=0==(this.stype&x)),0!=this.rarity&&(R|=0==(this.rarity&L)),""!=this.text&&(R|=!D.toLowerCase().includes(this.text.toLowerCase())),R?$(S).css("display","none"):$(S).css("display","inline")}}}}class FleetSlot{constructor(r,o){this.slotNo=r,this.html=o,this.shipId=-1,this.ttip=$(this.html).find(".ttip"),this.ttiplv=$(this.html).find(".ttiplv"),this.skillCtrl=$(this.html).find(".skill-show")}updateShip(r,o,g){if((-1!=this.shipId||-1!=r)&&this.shipId!=r){if(-1!=this.shipId){this.shipId=-1;let h=SIM_STATE.getShipAtSlot(this.slotNo-1);CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.REM_SHIP,{slot:this.slotNo-1,ship:h}),updateSelShipCombatStats()}if(this.shipId=r,-1!=r){let h=null;h=o?new ShipRetrofit(r):g?new PriorityShip(r):new Ship(r),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.ADD_SHIP,{slot:this.slotNo-1,ship:h}),updateSelShipCombatStats(),this.ttip.css("background","url('"+pathShipIcon(h.getIcon())+"'), url('img/bgs/"+ShipRarityToIcon[h.rarity]+".png')"),this.ttip.css("background-size","cover"),this.ttiplv.css("visibility","visible"),this.ttiplv.text(h.level),$(this.skillCtrl).data("toggle","modal"),$(this.skillCtrl).data("target","#modalSkillList"),$(this.skillCtrl).attr("data-toggle","modal"),$(this.skillCtrl).attr("data-target","#modalSkillList")}else 2==this.slotNo?(this.ttip.css("background","url('../img/flag.png') center no-repeat, url('../img/btn-add.png') center no-repeat, linear-gradient(#AAAAAA, lightgray)"),this.ttip.css("background-size","auto, cover")):(this.ttip.css("background","url('../img/btn-add.png') center no-repeat, linear-gradient(#AAAAAA, lightgray)"),this.ttip.css("background-size","cover")),this.ttiplv.css("visibility","hidden"),$(this.skillCtrl).data("toggle",""),$(this.skillCtrl).data("target",""),$(this.skillCtrl).attr("data-toggle",""),$(this.skillCtrl).attr("data-target","")}}updateExisting(){if(-1!=this.shipId){let r=SIM_STATE.getShipAtSlot(this.slotNo-1);this.ttiplv.text(r.level)}}}class TopFleet{constructor(){this.slots=[null,null,null,null,null,null],this.html=$("#ship-container");var r=$(this.html).find(".ship");6!=r.length&&console.log("Error parsing ship slots.");for(let o=0;6>o;o++)this.slots[o]=new FleetSlot(o+1,r[o]);this.currShipList=[-1,-1,-1,-1,-1,-1],this.filter=new SlotFilter}resetFilter(r){if(this.filter.clearAll(),r){let o=$(r).find(".filter-btn");o.attr("state","off"),o.removeClass("fil-on"),o.addClass("fil-off"),$(r).find(".tip-search").val("")}}filterChange(r,o){if(o==EFilterType.TEXT)this.filter.setText($(r).val());else if(o==EFilterType.BUTTON){let h=$(r).attr("state"),S=$(r).attr("filter"),I=$(r).parent().attr("filter-type");"off"==h?($(r).attr("state","on"),$(r).addClass("fil-on"),$(r).removeClass("fil-off"),this.filter[I]|=S):"on"==h&&($(r).attr("state","off"),$(r).addClass("fil-off"),$(r).removeClass("fil-on"),this.filter[I]^=S)}let g=$(r).parent().parent().parent().find(".ship-list");this.filter.applyFilter(g,this.currShipList)}updateList(){for(let r=0;6>r;r++)this.slots[r]&&(this.currShipList[r]=this.slots[r].shipId);this.applyFilter(this.currShipList)}applyFilter(r){this.filter.applyFilter(r,this.currShipList)}updateShip(r){var o=$(r).parent().attr("slot"),g=$(r).attr("iid"),h=$(r).data("retrofit"),S=$(r).data("priority");this.slots[o-1].updateShip(g,h,S)}updateSlot(r){this.slots[r].updateExisting()}}class TopStatPanel{constructor(){this.html=$("#form-status"),this.lbls=[],this.lbls.push($("#form-status").find("div[title |= 'Firepower']").find("div[class = attrval]")),this.lbls.push($("#form-status").find("div[title |= 'Torpedo']").find("div[class = attrval]")),this.lbls.push($("#form-status").find("div[title |= 'Anti-air']").find("div[class = attrval]")),this.lbls.push($("#form-status").find("div[title |= 'Air Power']").find("div[class = attrval]")),this.lbls.push($("#form-status").find("div[title |= 'Cost']").find("div[class = attrval]"))}updateValues(){let r=[EAttributes.CANNON,EAttributes.TORP,EAttributes.AA,EAttributes.AIR],o=SIM_STATE.fleet.getFleetStats();for(let h=0;4>h;h++)$(this.lbls[h]).text(o[r[h]]);let g=SIM_STATE.fleet.getFleetCost();$(this.lbls[4]).text(g)}}class TopPanel{constructor(){this.ammoDrop=new TopDropDown("ammo","ammo-drop",ECallbackTypes.UPD_AMMO),this.formDrop=new TopDropDown("form","form-drop",ECallbackTypes.UPD_FORM),this.fleet=new TopFleet,this.stats=new TopStatPanel}setCallbacks(){$(".ammo-option").click(function(){TOP_PANEL.ammoDrop.updateValue(this),TOP_PANEL.ammoDrop.activateCallbacks({sel:TOP_PANEL.ammoDrop.getValue()})}),$(".form-option").click(function(){TOP_PANEL.formDrop.updateValue(this),TOP_PANEL.formDrop.activateCallbacks({sel:TOP_PANEL.formDrop.getValue()})}),$(".tip-search").on("input",function(){TOP_PANEL.fleet.filterChange(this,EFilterType.TEXT)}),$(".filter-btn").click(function(){TOP_PANEL.fleet.filterChange(this,EFilterType.BUTTON)}),CALLBACK_MANAGER.register(ECallbackTypes.ADD_SHIP,function(){TOP_PANEL.stats.updateValues(),TOP_PANEL.fleet.updateList()}),CALLBACK_MANAGER.register(ECallbackTypes.REM_SHIP,function(){TOP_PANEL.stats.updateValues(),TOP_PANEL.fleet.updateList()}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_SHIP,function(r){TOP_PANEL.stats.updateValues(),TOP_PANEL.fleet.updateSlot(r.slot)}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_FORM,function(){TOP_PANEL.stats.updateValues()})}getFormationFunc(){return DFormationFunc[this.formDrop.getValue()]}getAmmoFunc(){return DAmmoFunc[this.ammoDrop.getValue()]}}function setModalCallbacks(){$("#modalPickShip").on("show.bs.modal",function(r){let o=$(r.relatedTarget),g=o.data("slot"),h=o.data("type"),S=$(this),I=S.find(".ship-list");I.removeClass("frontline"),I.removeClass("backline"),I.addClass(h),I.attr("slot",g),I.children().remove().end();let A={frontline:EClass.FRONTLINE,backline:EClass.BACKLINE};I.append("<img data-dismiss='modal' iid='-1' title=' Remove' class='alimg hvr-grow rem' src='img/btn-add.png' />");let y=Object.keys(SHIP_DATABASE);for(let x=0;x<y.length;x++){let L=SHIP_DATABASE[y[x]],D="";L.isPriority&&(D="data-priority='1'"),0!=(L.shipType&A[h])&&I.append("<img "+D+" data-dismiss='modal' iid='"+L.groupId+"' title='"+L.enName+"' class='alimg hvr-grow "+rarityToClass[L.rarity]+"' src='"+pathShipIcon(L.groupId)+"' />")}let E=Object.keys(SHIP_RETRO_DATABASE);for(let L,x=0;x<E.length;x++)L=SHIP_RETRO_DATABASE[E[x]],0!=(L.shipType&A[h])&&I.append("<img data-retrofit='1' data-dismiss='modal' iid='"+L.groupId+"' title='"+L.enName+"' class='alimg hvr-grow "+rarityToClass[L.rarity]+"' src='"+pathShipIcon("r"+L.groupId)+"' />");TOP_PANEL.fleet.resetFilter(S),TOP_PANEL.fleet.applyFilter(I),$(".alimg").click(function(){TOP_PANEL.fleet.updateShip(this)}),$(".rem").click(function(){TOP_PANEL.fleet.updateShip(this)})}),$("#modalPickEquip").on("show.bs.modal",function(r){let o=$(r.relatedTarget),g=o.data("slot"),h=o.data("type"),S=o.data("shiptype"),I=$(this),A=I.find(".equip-list");A.attr("slot",g),A.attr("type",h),A.attr("stype",S),A.children().remove().end(),A.append("<div class='eqdiv hvr-grow eqrem'><img data-dismiss='modal' iid='-1' title=' Remove' class='eqimg' src='img/btn-add.png' /></div>");let y=Object.keys(EQUIPS_DATABASE);for(let x,E=0;E<y.length;E++)x=EQUIPS_DATABASE[y[E]],0==x.obtainable||0==(x.type&h)||0!=(x.forbiddenMask&S)||A.append("<div class='eqdiv hvr-grow "+EqRarityToClass[x.stars]+"'><img data-dismiss='modal' iid='"+x.id+"' title='"+x.name+"' class='eqimg' style='display:flex;' src='"+pathEquipIcon(x.icon)+"' /><img class='imgstars' src='img/stars/"+x.stars+".png' /></div>");$(".eqimg").click(function(){updateShipEq(this)})}),$("#modalSkillList").on("show.bs.modal",function(r){let o=$(r.relatedTarget),g=parseInt(o.data("slot")),h=$(this),S=SIM_STATE.getShipAtSlot(g-1);if(S){let I=$(h).find(".modal-body");I.children().remove().end();let A=S.skills;for(let y=0;y<A.length;y++)0!=y&&I.append("<hr class='my-3' />"),I.append(getSkillEntryHtml(y,A[y]));$(I).data("slot",g),$(".sel-skill-level").change(function(){let y=$(this).parent().parent().data("sidx"),E=$(this).parent().parent().parent().data("slot"),x=parseInt($(this).val()),L=SIM_STATE.getShipAtSlot(E-1),D=L.skills[y];D.getLevel()!=x&&(D.setLevel(x),$(this).parent().parent().find(".skill-desc-text").text(D.getDescription()),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:L.fleetSlot,ship:L,type:EShipUpdateFlag.UPD_SKILL,skill:D}))}),$(".sel-skill-stacks").change(function(){let y=$(this).parent().parent().data("sidx"),E=$(this).parent().parent().parent().data("slot"),x=parseInt($(this).val()),L=SIM_STATE.getShipAtSlot(E-1),D=L.skills[y];D.getStacks()!=x&&(D.setStacks(x),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:L.fleetSlot,ship:L,type:EShipUpdateFlag.UPD_SKILL,skill:D}))}),$(".sel-skill-mode").change(function(){let y=$(this).parent().parent().data("sidx"),E=$(this).parent().parent().parent().data("slot"),x=$(this).val(),L=SIM_STATE.getShipAtSlot(E-1),D=L.skills[y];D.getMode()!=x&&(D.setMode(x),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:L.fleetSlot,ship:L,type:EShipUpdateFlag.UPD_SKILL,skill:D}),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:L.fleetSlot,ship:L,type:EShipUpdateFlag.UPD_EQ,skill:D}))}),$(".checkSkillEnabled").change(function(){let y=this.checked,E=$(this).parent().parent(),x=$(this).parent().parent().data("sidx"),L=$(this).parent().parent().parent().data("slot"),D=SIM_STATE.getShipAtSlot(L-1),R=y!=D.skills[x].getState();D.skills[x].setState(y),y&&D.skills[x].isValid()?(1!=D.skills[x].getMaxLevel()&&$(E).find(".sel-skill-level").removeAttr("disabled"),$(E).find(".skill-entry-icon").removeClass("skill-disabled"),$(E).find(".skill-entry-desc").removeClass("skill-disabled-text")):($(E).find(".sel-skill-level").attr("disabled","True"),$(E).find(".skill-entry-icon").addClass("skill-disabled"),$(E).find(".skill-entry-desc").addClass("skill-disabled-text")),R&&CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:D.fleetSlot,ship:D,type:EShipUpdateFlag.UPD_SKILL,skill:D.skills[x]})}),$(".checkSkillEnabled").change()}})}function updateSelShipCombatStats(){let r=SHIP_SEL_DROP.selShip;if(r){let o=SKILL_MANAGER.applyToShip(r),g=SKILL_MANAGER.aggregateBuffs(o);r.addStatBuffs(g.statsR,g.stats);let h=g.props.efficiencyIdx;r.addEfficiencies(h),SKILL_MANAGER.setShipBuffs(r),console.log(g.skillLst),console.log(g),STATS_PANEL.mode==EStatsPanelMode.FULL_STATS&&(STATS_PANEL.updateValues(r),EQUIP_SLOTS.update(r,EShipUpdateFlag.UPD_LB))}}function updateShipEq(r){let o=SHIP_SEL_DROP.selShip,g=$(r).attr("iid"),h=$(r).parent().parent(),S=$(h).attr("slot");if(o){if(-1==g)o.removeEquipment(S);else{o.setEquipment(S,g);let I=o.slots[S-1].getUpgList();o.slots[S-1].setUpgrade(parseInt(I[I.length-1]))}o.refreshStats(),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.UPD_SHIP,{slot:o.fleetSlot,ship:o,eqSlot:S-1,eq:o.slots[S-1].getEquipment(),type:EShipUpdateFlag.UPD_EQ}),STATS_PANEL.updateValues(o)}}class CShipSelDrop{constructor(){this.html=$(".cship-sel-drop"),this.content=$(this.html).find(".cship-drop-cont"),this.selHtml=$("#csel-ship-drop"),this.selected=-1,this.selShip=null}getSelected(){return this.selected}getSelShip(){return this.selShip}clear(){$(this.content).find("div").remove().end()}refresh(){this.clear();let r=SIM_STATE.getAllShips();for(let o=0;o<r.length;o++)this.addEntry(o,r[o]);if(-1!=this.selected&&this.selShip){let o=SIM_STATE.getShipAtSlot(this.selected);o||this.resetSelected()}this.setClickCallbacks()}addEntry(r,o){let g=$.parseHTML("<div class=\"dropdown-item cship-opt\" opt=\""+o.fleetSlot+"\"><div>"+o.enName+"</div></div>");$(g).css("background","url(../img/triggers/"+o.icon+".png) no-repeat"),$(g).css("background-size","contain"),$(g).css("background-color","#EEEEEE"),$(g).hover(function(){$(this).css("background-color","#CCCCCC")},function(){$(this).css("background-color","#EEEEEE")}),$(this.content).append(g)}select(r){if(this.getSelected()!=r){$(this.selHtml).attr("sel",r);let o=SIM_STATE.getShipAtSlot(r);$(this.selHtml).css("background","url(../img/triggers/"+o.icon+".png) no-repeat"),$(this.selHtml).css("background-size","contain"),$(this.selHtml).find("div").text(o.enName),this.selShip=o,this.selected=r,CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.SEL_SHIP_COMBAT,{ship:o})}}resetSelected(){$(this.selHtml).attr("sel",-1),$(this.selHtml).css("background","url(../img/triggers/-1.png) no-repeat"),$(this.selHtml).css("background-size","contain"),$(this.selHtml).find("div").text("Select ship"),this.selShip=null,this.selected=-1,CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.SEL_SHIP_COMBAT,{ship:null})}setClickCallbacks(){$(".cship-opt").click(function(){COMBAT_SHIP_SEL_DROP.select($(this).attr("opt"))})}setCallbacks(){CALLBACK_MANAGER.register(ECallbackTypes.ADD_SHIP,function(){console.log("Combat ship drop"),COMBAT_SHIP_SEL_DROP.refresh()}),CALLBACK_MANAGER.register(ECallbackTypes.REM_SHIP,function(){COMBAT_SHIP_SEL_DROP.refresh()}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_SHIP,function(){COMBAT_SHIP_SEL_DROP.refresh()})}}class EquipSelDrop{constructor(){this.html=$(".equip-sel-drop"),this.content=$(this.html).find(".equip-drop-cont"),this.selHtml=$("#sel-equip-drop"),this.selected=-1,this.selEquip=null,this.ship=null,this.slots=[]}getSelected(){return this.selected}clear(){$(this.content).find("div").remove().end()}refreshSlots(r){if(this.slots=[],r){let o=r.getSlots();for(let h,g=0;g<o.length;g++)h=o[g],h.isWeapon()&&this.slots.push(h);if(r.hasHiddenGun()&&this.slots.push(r.getHiddenGun()),r.hasBarrage){let g=r.getBarrages();for(let h=0;h<g.length;h++)this.slots.push(g[h])}}}updateShip(r){let o=COMBAT_SHIP_SEL_DROP.getSelShip();o&&r&&r.id==o.id&&(this.resetSelected(),this.ship=o,this.refresh())}refresh(){this.clear();let r=COMBAT_SHIP_SEL_DROP.getSelShip();(!r||this.ship&&this.ship.id!=r.id)&&this.resetSelected(),this.refreshSlots(r);for(let o=0;o<this.slots.length;o++)this.addEntry(o,this.slots[o]);this.setClickCallbacks()}addEntry(r,o){let g=$.parseHTML("<div class=\"dropdown-item equip-opt\" opt=\""+r+"\"><div>"+o.getEquipName()+"</div></div>");o.isEquipSlot()?$(g).css("background","url("+pathEquipIcon(o.getIcon(),!0)+") 10px -30px / 90px 90px no-repeat"):$(g).css("background","url("+pathSkillIcon(o.getIcon(),!0)+") 10px -30px / 90px 90px no-repeat"),$(g).css("background-color","#EEEEEE"),$(g).hover(function(){$(this).css("background-color","#CCCCCC")},function(){$(this).css("background-color","#EEEEEE")}),$(this.content).append(g)}select(r){if(this.getSelected()!=r){$(this.selHtml).attr("sel",r);let o=this.slots[r];o.isEquipSlot()?$(this.selHtml).css("background","url("+pathEquipIcon(o.getIcon(),!0)+") 10px -30px / 90px 90px no-repeat"):$(this.selHtml).css("background","url("+pathSkillIcon(o.getIcon(),!0)+") 10px -30px / 90px 90px no-repeat"),$(this.selHtml).find("div").text(o.getEquipName()),this.selEquip=o,this.selected=r,this.ship=COMBAT_SHIP_SEL_DROP.getSelShip(),CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.SEL_EQUIP,{equip:o})}}resetSelected(){$(this.selHtml).attr("sel",-1),$(this.selHtml).css("background","url(../img/equip/null.png) 10px -30px / 90px 90px no-repeat"),$(this.selHtml).find("div").text("Select equip"),this.selEquip=null,this.selected=-1,this.ship=null,CALLBACK_MANAGER.activateCallbacks(ECallbackTypes.SEL_EQUIP,{equip:null})}refreshList(r){this.clear(),this.refreshSlots(r);for(let o=0;o<this.slots.length;o++)this.addEntry(o,this.slots[o]);this.setClickCallbacks()}onShipSelected(r){this.resetSelected(),this.ship=r,r?this.refreshList(r):this.clear()}onEquipUpdated(r){let o=r.ship;this.ship&&o&&this.ship.getId()==o.getId()&&(this.selEquip&&this.selEquip.getSlotNo()-1==r.eqSlot?this.onShipSelected(o):this.refreshList(o))}setClickCallbacks(){$(".equip-opt").click(function(){EQUIP_SEL_DROP.select($(this).attr("opt"))})}setCallbacks(){CALLBACK_MANAGER.register(ECallbackTypes.SEL_SHIP_COMBAT,function(r){EQUIP_SEL_DROP.onShipSelected(r.ship)}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_SHIP,function(r){r.type==EShipUpdateFlag.UPD_EQ&&3>r.eqSlot?EQUIP_SEL_DROP.onEquipUpdated(r):r.type==EShipUpdateFlag.UPD_SKILL&&(r.eqSlot=r.skill.getId()-1,EQUIP_SEL_DROP.onEquipUpdated(r))})}}class CombatMainUI{constructor(){this.skillDisplay=$("#skillDisplay")}updateSkillList(){let r={trigger:"hover",placement:"top"};$(this.skillDisplay).children().remove().end();let o=SKILL_MANAGER.getCurrentSkillList(),g=Object.keys(o);for(let h=0;h<g.length;h++){let S=g[h],I=o[S][0].getSkill(),A=pathSkillIcon(I.getIcon()),y="s"+S,x=$.parseHTML("<img class='skill-icon-lst' width='40' id='"+y+"' src='"+A+"' />");$(this.skillDisplay).append(x);let L=I.getOwner().getName();r.title="Formation"==L?I.getName():I.getOwner().getName()+"'s\n"+I.getName(),r.content="";for(let D=0;D<o[S].length;D++)r.content+=o[S][D].getString(),D!=o[S].length-1&&(r.content+="\n");$("#"+y).popover(r)}}setCallbacks(){CALLBACK_MANAGER.register(ECallbackTypes.SEL_SHIP_COMBAT,function(r){r.ship&&(SKILL_MANAGER.setShipBuffs(r.ship),COMBAT_MAIN_UI.updateSkillList(r.ship))})}}function isEmpty(r){for(var o in r)if(r.hasOwnProperty(o))return!1;return!0}class SkillManager{constructor(){this.effects=[],this.formBuffs={},this.formBuffs[0]={getEffects(){return[]}},this.formBuffs[1]=new Skill(100,null,{getId(){return 100},getName(){return"Formation"}}),this.formBuffs[2]=new Skill(110,null,{getId(){return 110},getName(){return"Formation"}}),this.formBuffs[3]=new Skill(120,null,{getId(){return 120},getName(){return"Formation"}}),this.ammoBuffs={},this.ammoBuffs.neutral={getEffects(){return[]}},this.ammoBuffs.plenty=new Skill(200,null,{getId(){return 200},getName(){return"Ammo"}}),this.ammoBuffs.empty=new Skill(210,null,{getId(){return 210},getName(){return"Ammo"}}),this.otherEffects=[],this.selForm="0",this.selAmmo="neutral",CALLBACK_MANAGER.register(ECallbackTypes.ADD_SHIP,function(r){SKILL_MANAGER.addShip(r.ship)}),CALLBACK_MANAGER.register(ECallbackTypes.REM_SHIP,function(r){SKILL_MANAGER.remShip(r.ship)}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_SHIP,function(r){(r.type==EShipUpdateFlag.UPD_SKILL||r.type==EShipUpdateFlag.UPD_EQ)&&SKILL_MANAGER.updShip(r.ship)}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_FORM,function(r){SKILL_MANAGER.updForm(r.sel)}),CALLBACK_MANAGER.register(ECallbackTypes.UPD_AMMO,function(r){SKILL_MANAGER.updAmmo(r.sel)})}updForm(r){this.selForm=r,this.refreshFormAmmo()}updAmmo(r){this.selAmmo=r,this.refreshFormAmmo()}refreshFormAmmo(){this.otherEffects=[];let r=this.formBuffs[this.selForm],o=r.getEffects();for(let g=0;g<o.length;g++)this.otherEffects.push(o[g]);r=this.ammoBuffs[this.selAmmo],o=r.getEffects();for(let g=0;g<o.length;g++)this.otherEffects.push(o[g])}addShip(r){let o=r.getSkills(),g=[];for(let I,S=0;S<o.length;S++){I=o[S].getEffects();for(let A=0;A<I.length;A++)I[A].isSelfBuff()?g.push(I[A]):this.effects.push(I[A])}let h=r.getEquipSkills();for(let I,S=0;S<h.length;S++){I=h[S].getEffects();for(let A=0;A<I.length;A++)I[A].isSelfBuff()?g.push(I[A]):this.effects.push(I[A])}r.selfBuffs=g}remShip(r){let g=this.effects.filter(function(h,S){return S.getOwner().getId()!=h}.bind(this,r.getId()));this.effects=g}updShip(r){this.remShip(r),this.addShip(r)}applyToShip(r){let o={};r.clearModsReqs(),o.ship=r,o.fleet=SIM_STATE.fleet,o.skillDict=new SkillEffectAcc;for(let h,g=0;g<this.otherEffects.length;g++)h=this.otherEffects[g],h.apply(o);if(r.selfBuffs)for(let g=0;g<r.selfBuffs.length;g++)r.selfBuffs[g].apply(o);for(let h,g=0;g<this.effects.length;g++)h=this.effects[g],h.apply(o);return o}aggregateBuffs(r){let o={props:{},stats:[],statsR:[]};return initProps(o.props),o.stats=[0,0,0,0,0,0,0,0,0,0,0,0],o.statsR=[0,0,0,0,0,0,0,0,0,0,0,0],r.skillDict.aggregateBuffs(o),o}setShipBuffs(r){let o=this.applyToShip(r),g=this.aggregateBuffs(o);r.addStatBuffs(g.statsR,g.stats),this.currSkillLst=g.skillLst}getCurrentSkillList(){return this.currSkillLst}}class Skill{constructor(r,o,g){this.id=-1,this.isActive=!1,this.owner=g,this.stacks=1,this.load(r,o)}getId(){return this.id}load(r,o){let g=loadSkill(r);g&&(this.skillData=g,this.id=g.id,this.name=g.name,this.type=g.type,this.icon=g.icon,this.desc=g.desc,this.maxLvl=parseInt(g.maxLvl),this.isBarrage=g.isBarrage,this.isCommand=g.isCommand,this.isConditional=g.conditional,this.isStacks=!1,this.maxStacks=0,"hasStacks"in g&&(this.isStacks=!0,this.maxStacks=g.maxStacks,this.stacks=0),this.isModes=!1,this.modes=[],this.mode="","hasModes"in g&&(this.isModes=!0,this.modes=g.modes,this.mode=this.modes[0]),this.isActive=!0,this.descLvls=g.descLvls,this.skillEffData=loadSkillEffect(this.id),this.enabled=!1,this.skillEffData&&(this.enabled=this.skillEffData.active),this.isActive=this.enabled,this.effects=[],o?this.setLevel(o):this.setLevel(-1))}getStacks(){return this.stacks}hasStacks(){return this.isStacks}getMaxStacks(){return this.maxStacks}setStacks(r){this.stacks=r}hasModes(){return this.isModes}getMode(){return this.mode}getModes(){return this.modes}setMode(r){this.mode=r}isEnabled(){return this.isActive}isValid(){return this.enabled}setState(r){this.isActive=r}getState(){return this.isActive}getName(){return this.name}getMaxLevel(){return this.maxLvl}getLevel(){return this.lvl}setLevel(r){this.lvl=parseInt(r),(0>=this.lvl||10<this.lvl||this.lvl>this.maxLvl)&&(this.lvl=this.maxLvl),"lv"in this.skillData&&(this.lvlData=this.skillData.lv[this.lvl-1]),this.loadEffect(this.lvl-1)}loadEffect(){if(this.skillEffData&&this.enabled){let o=this.skillEffData.lvls[this.lvl-1];this.effects=[];for(let h,g=0;g<o.length;g++)h=o[g],isEmpty(h)||this.effects.push(new SkillEffectEntry(this,h,this.owner))}}getIcon(){return this.icon}getDescription(){let r=/\$([\d+])/m,o=this.desc,g=[];for(let I,S=0;S<this.descLvls.length;S++)I=this.descLvls[S],g.push(I[this.lvl-1][0]);for(let h=null;h=r.exec(o);)if(h&&"1"in h){let S=parseInt(h[1]);o=o.replace(r,g[S-1])}return o}setOwner(r){this.owner=r}getOwner(){return this.owner}getEffects(){let r=[],o=this.effects;if(!o)return[];for(let h,g=0;g<o.length;g++){h=o[g].getEffects();for(let I,S=0;S<h.length;S++)I=h[S],r.push(I)}return r}}class SkillEffectEntry{constructor(r,o){this.skill=r,this.loadEffect(o)}isActive(){return this.skill.isEnabled()}getId(){return this.skill.getId()}getIcon(){return this.skill.getIcon()}getSkill(){return this.skill}getConditional(r){return 0<=r&&r<this.conds.length?this.conds[r]:null}getEffects(){let r=[];for(let o=0;o<this.effects.length;o++)r.push(this.effects[o]);for(let o=0;o<this.condEffs.length;o++)r.push(this.condEffs[o]);return r}loadEffect(r){if(this.affectsSelf=loadIfExists(r,"affectsSelf",!1),this.time=loadIfExists(r,"time",-1),this.rant=loadIfExists(r,"rant",-1),this.conds=[],this.condEffs=[],this.effects=[],"condEffs"in r){this.conditional=!0,this.condData=loadIfExists(r,"conds",[]);for(let h,g=0;g<this.condData.length;g++)h=this.condData[g],h&&(h.choiceType==ETargetTypes.CHECK_TARGET||h.choiceType==ETargetTypes.CHECK_WEAPON?this.conds.push(new CheckTarget(this,h)):this.conds.push(new Conditional(this,h)));this.condEffData=loadIfExists(r,"condEffs",[]);let o=Object.keys(this.condEffData);for(let g=0;g<o.length;g++){let h=o[g],S=this.condEffData[h];if(S){let I=S.effect;if(I)for(let y,A=0;A<I.length;A++)y=new SkillEffect(this,I[A],this.skill.getOwner()),y.setCondition(this.conds[parseInt(h)]),y.setAffectsSelf(this.affectsSelf),this.condEffs.push(y)}}}if("effect"in r){this.effectsData=r.effect;for(let g,o=0;o<this.effectsData.length;o++)g=new SkillEffect(this,this.effectsData[o],this.skill.getOwner()),g.setAffectsSelf(this.affectsSelf),this.effects.push(g)}}}class SkillEffect{constructor(r,o,g){this.skillEff=r,this.owner=g,this.stacks=r.getSkill().getStacks(),this.loadEffect(o)}loadEffect(r){this.id=r.id,this.type=r.type,this.onStack=r.onStack,this.args=r.args,this.useStacks=!1,"fromStacks"in r&&(this.useStacks=!0),this.useModes=!1,this.mode=null,"useModes"in r&&(this.useModes=!0,this.mode=r.mode),this.cond=null,this.eff=buildLeafEffect(this.id,this.args,this.type),this.eff&&this.eff.setParent(this)}apply(r){r.owner=this.owner,r.affectsSelf=this.affectsSelf,this.isActive()&&(!this.cond||this.cond.validate(r))&&(this.useStacks&&(r.stacks=this.getSkill().getStacks()),this.eff&&(!this.useModes||this.useModes&&this.getSkill().getMode()==this.mode)&&this.eff.apply(r),r.stacks=1)}setCondition(r){this.cond=r}isSelfBuff(){return!this.cond||this.cond.isCheckTarget()}getOwner(){return this.skillEff.getSkill().getOwner()}setOwner(r){this.owner=r}isActive(){return this.skillEff.isActive()}getSkill(){return this.skillEff.getSkill()}setAffectsSelf(r){this.affectsSelf=r}getString(){return this.eff?this.eff.getString():""}}class Conditional{constructor(r,o){if(this.parent=r,this.entry=o,this.id=loadIfExists(o,"id",-1),this.type=loadIfExists(o,"choiceType",-1),this.args=loadIfExists(o,"args",{}),this.targetOthers=loadIfExists(o,"targetOthers",!1),this.preCond=loadIfExists(o,"preCond",-1),this.isEmpty=0==o.length||-1==this.type,this.valFunc=null,this.type instanceof Array){let h=[];for(let S=0;S<this.type.length;S++)this.type[S]in DValidateFunctions&&h.push(DValidateFunctions[this.type[S]]);this.valFunc=function(S,I,A){for(let y=0;y<S.length;y++)if(!S[y](I,A))return!1;return!0}.bind(this,h)}else this.type in DValidateFunctions&&(this.valFunc=DValidateFunctions[this.type])}isCheckTarget(){return!1}validate(r){if(this.isEmpty)return!0;let o=!0;if(-1!=this.preCond){let g=this.parent.getConditional(this.preCond);o=g.validate(r)}return o&&this.valFunc(r,this.args)}}class CheckTarget extends Conditional{constructor(r,o){super(r,o),this.checkTarget=loadIfExists(this.args,"check_target",[]),this.minTarget=loadIfExists(this.args,"minTargetNumber",-1),this.maxTarget=loadIfExists(this.args,"maxTargetNumber",99999),this.isStacked=loadIfExists(this.args,"isBuffStackByCheckTarget",!1),this.exceptCaster=loadIfExists(this.args,"exceptCaster",!1),0==this.checkTarget.length&&"check_weapon"in this.args&&(this.checkTarget=["TargetWeapon"],this.minTarget=loadIfExists(this.args,"minWeaponNumber",-1),this.maxTarget=loadIfExists(this.args,"maxWeaponNumber",99999)),this.checkTarget instanceof Array||(this.checkTarget=[this.checkTarget])}isCheckTarget(){if(-1!=this.preCond){let r=this.parent.getConditional(this.preCond);return r.isCheckTarget()}return!0}validate(r){if(this.isEmpty)return!0;let o=!0;if(-1!=this.preCond){let S=this.parent.getConditional(this.preCond);o=S.validate(r)}if(!o)return!1;r.currLst=null;for(let S=0;S<this.checkTarget.length;S++){let I=this.checkTarget[S],A=evaluateCheckTarget(I,r,this.args);r.currLst=A}let g=r.currLst,h=g.length;return this.exceptCaster&&(h=Math.max(0,h-1)),this.isStacked&&(r.stacks=h),h>=this.minTarget&&h<=this.maxTarget}}class Barrage{constructor(r){this.weapons=[],this.skill=r,this.loadBarrage(r)}loadBarrage(r){r&&r.isBarrage&&this.refresh()}getSkill(){return this.skill}isBarrage(){return!0}isEquipSlot(){return!1}getEquipName(){return this.getName()}getSlotNo(){return this.getId()}getId(){return this.skill.id}getName(){return this.skill.getName()}getLevel(){return this.skill.getLevel()}getMaxLevel(){return this.skill.getMaxLevel()}getIcon(){return this.skill.getIcon()}isGunBarrage(){return this.skill.skillData.isGunBarrage}isSkillBarrage(){return this.skill.skillData.isSkillBarrage}refresh(){if(this.lvl!=this.skill.getLevel()){this.lvl=this.skill.getLevel(),this.weapIds=this.skill.skillData.lv[this.lvl-1].weaponId;let r={};this.weapons=[];for(let o=0;o<this.weapIds.length;o++)if(isAircraft(this.weapIds[o])){let g=new Aircraft(this.weapIds[o]),h=g.airWeapons;for(let I,S=0;S<h.length;S++)I=h[S].getId(),I in r?r[I].addSpawn():(r[I]=h[S],this.weapons.push(h[S]))}else if(this.weapIds[o]in r)r[this.weapIds[o]].addSpawn();else{let g=new Weapon(this.weapIds[o]);r[this.weapIds[o]]=g,this.weapons.push(g)}}}setLevel(r){this.skill.setLevel(r),this.refresh()}getDescs(){let r=[];for(let o=0;o<this.weapons.length;o++){let g=this.weapons[o],h={};h.dmg=g.getDamage(),h.dmgAttr=g.getDamageAttr(),h.scale=g.getDamageAttrRatio(),h.coef=g.getCoefficient(),h.bullets=[];let S=[],I={},A=Object.keys(g.ammoBullet),y=0;for(let L,x=0;x<A.length;x++){L=g.spawns*g.ammoBullet[A[x]],y+=L;let D={ammo:L,mods:BULLETS_INSTANCE_DB[A[x]].getModifiers()},R=objectHash(D.mods);R in I?I[R].obj.ammo+=D.ammo:I[R]={obj:D};let T=BULLETS_INSTANCE_DB[A[x]].getAmmoType();4>T&&-1==S.indexOf(T)&&S.push(T)}let E=Object.keys(I);for(let x=0;x<E.length;x++)h.bullets.push(I[E[x]].obj);h.props=S,h.ammo=y,r.push(h)}return r}getWeapons(){return this.weapons}}class SimState{constructor(){this.fleet=new Fleet}remShip(r){this.fleet.removeShip(r)}addShip(r,o){this.fleet.addShip(r,o)}getShipAtSlot(r){return this.fleet.getShip(r)}getAllShips(){let r=[];for(let g,o=0;6>o;o++)g=this.fleet.getShip(o),g&&r.push(g);return r}setCallbacks(){CALLBACK_MANAGER.register(ECallbackTypes.ADD_SHIP,function(r){SIM_STATE.addShip(r.slot,r.ship)}),CALLBACK_MANAGER.register(ECallbackTypes.REM_SHIP,function(r){SIM_STATE.remShip(r.slot)})}}var EWeaponTypes={MAIN_CANNON:1,SUB_CANNON:2,TORPEDO:3,ANTI_AIR:4,ARMOR:5,ENGINE:6,RADAR:7,PASSIVE_SCOUT:10,SCOUT:11,CREW:12,CHARGE:13,SPECIAL:14,MEGA_CHARGE:15,MANUAL_TORPEDO:16,ANTI_SEA:17,HAMMER_HEAD:18,BOMBER_PRE_CAST_ALERT:19,MULTI_LOCK:20,MANUAL_SUB:21,FLEET_ANTI_AIR:22,POINT_HIT_AND_LOCK:23,BEAM:24,DEPTH_CHARGE:25,PREVIEW_ARICRAFT:99,AIR_ASSIST:100},EBulletTypes={CANNON:1,BOMB:2,TORPEDO:3,DIRECT:4,SHRAPNEL:5,ANTI_AIR:6,ANTI_SEA:7,STRAY:8,EFFECT:9,BEAM:10};class Equipment{constructor(r){this.id=r,this.upgId=r,this.name="",this.type=-1,this.avoidBonus=0,this.ambushBonus=0,this.descs=[],this.stats=[];for(let o=0;o<NUM_ATTRS;o++)this.stats[o]=0;this.upgrade=10,this.upgLst=[],this.icon=null,this.stars=null,this.default=!1}getId(){return this.id}getUpgId(){return this.upgId}setName(r){this.name=r}getName(){return this.name}getStats(){return this.stats}hasStats(){return this.stats.some(function(r){return 0!=r})}isDefault(){return this.default}isWeapon(){return!1}isBarrage(){return!1}setUpgrade(){console.log("'setUpgrade': Not implemented.")}getUpgrade(){return this.upgrade}getUpgList(){return this.upgLst}getIcon(){return this.icon}getStars(){return this.stars}getAmmoType(){return null}getReloadTime(){return 0}getWeapons(){return[]}getSkills(){return[]}}class TrueEquipment extends Equipment{constructor(r,o){super(r),this.weapons=null,this.weaponIds=null,this.skills=[],o||this.load()}load(){let r=dbLoadEquipMap(this.id),o=loadEquipData(r.base);this.upgrade=r.upgrade,this.id=r.base,this.eqData=o,this.upgData=o.upgrades,this.upgLst=Object.keys(o.upgrades),this.name=o.name,this.nation=o.nation,this.tech=o.tech,this.stars=o.stars,this.type=o.type,this.avoidBonus=o.avoidBonus,this.ambushBonus=o.ambusBonus,this.icon=o.icon,this.forbiddenMask=o.forbiddenMask,this.attrsMeta=o.attrs_meta,this.skillIds=[],"skills"in o&&(this.skillIds=o.skills),this.setUpgrade(this.upgrade)}getNation(){return this.nation}setUpgrade(r){if(0>r||10<r||!(r in this.upgLst))return void console.log("Invalid weapon upgrade number.");this.upgrade=r,this.attrVals=this.upgData[r].attrs_val,this.stats=this.upgData[r].attrs,this.upgId=this.upgData[r].id,this.descs=[];let o=Object.keys(this.attrsMeta);for(let g=0;g<o.length;g++)this.descs.push({name:this.attrsMeta[o[g]].name,val:this.attrVals[o[g]]});this.loadSkills()}loadSkills(){this.skills=[];for(let r=0;r<this.skillIds.length;r++)this.skills.push(new Skill(this.skillIds[r],null,this))}getSkills(){return this.skills}}class WeaponEquipment extends TrueEquipment{constructor(r,o){super(r,o),o||this.loadWeapon()}isWeapon(){return!0}loadWeapon(){}getWeapons(){return this.weapons}setUpgrade(r){return 0>r||10<r||!(r in this.upgLst)?void console.log("Invalid weapon upgrade number."):void(super.setUpgrade(r),this.__setUpgrade(r))}__setUpgrade(){this.upgData[0];this.weaponIds=this.upgData[this.upgrade].weaponIds,this.weapons=[];for(let g=0;g<this.weaponIds.length;g++)this.weapons.push(new Weapon(this.weaponIds[g]));this.isMultiWeapon=!1,1<this.weapons.length&&(this.isMultiWeapon=!0)}getBaseDmg(){return this.weapons[0].dmg}getReload(){return this.weapons[0].rel}getReloadTime(){return this.weapons[0].rel/(6*Math.sqrt(628))}getAmmoCount(){return this.weapons[0].ammo[0]}getAmmoType(){return this.weapons[0].getAmmoType()}getRange(){return this.weapons[0].range}}class AircraftEquipment extends WeaponEquipment{constructor(r,o,g){super(r,o),g&&(this.weaponIds=[r]),this.loadAircraft()}setUpgrade(r){super.setUpgrade(r),this.loadAircraft()}loadAircraft(){this.aircraftLst=[];for(let r=0;r<this.weaponIds.length;r++)this.aircraftLst.push(new Aircraft(this.weaponIds[r]));this.actives=[],this.passives=[];for(let o,r=0;r<this.aircraftLst.length;r++)o=this.aircraftLst[r],o.isPassive()?this.passives.push(o):this.actives.push(o)}getReloadTime(){return 0<this.actives.length?this.actives[0].getReloadTime():0}getPassiveReloadTime(){return 0<this.passives.length?this.passives[0].getReloadTime():0}getAmmoType(){return 0}getWeapons(){return this.actives[0].getWeapons()}}class Aircraft{constructor(r){this.id=r,this.passive=!1,this.type=0,this.loadAircraft()}getId(){return this.id}isPassive(){return this.passive}getReload(){return this.aircraftWeap.getReload()}getReloadTime(){return this.aircraftWeap.getReload()/(6*Math.sqrt(628))}getWeapons(){return this.airWeapons}loadAircraft(){this.aircraftWeap=new Weapon(this.id),this.spawns=this.aircraftWeap.ammo;let r=dbLoadAircraftMap(this.id);this.airData=loadAircraftData(r.base),this.airId=r.base,this.airUpg=r.upgrade;let o=this.airData.upgrades[this.airUpg],g=this.airData.upgrades[0];this.maxHp=loadIfExists(o,"maxhp",g.maxhp),this.hpGrowth=loadIfExists(o,"hpgrowth",g.hpgrowth),this.acc=loadIfExists(o,"accuracy",g.accuracy),this.accGrowth=loadIfExists(o,"accgrowth",g.accgrowth),this.hpGrowth=loadIfExists(o,"hpgrowth",g.hpgrowth),this.crashDmg=loadIfExists(o,"crashDmg",g.crashDmg),this.attpower=loadIfExists(o,"atkpower",g.atkpower),this.speed=loadIfExists(o,"speed",g.speed),this.type=this.airData.type,this.nation=this.airData.nation,this.passive=this.aircraftWeap.getType()==EWeaponTypes.SCOUT,this.airWeaponIds=o.weaponIds,this.isMultiWeap=!1,1<this.airWeaponIds.length&&(this.isMultiWeap=!0),this.airWeapons=[];for(let h=0;h<this.airWeaponIds.length;h++){let S=this.airWeaponIds[h],I=new Weapon(S);I.setSpawns(this.spawns),this.airWeapons.push(I)}}}class Weapon{constructor(r,o,g){this.name="",this.id=r,this.upgrade=o,this.multiBullet=!1,this.upgLst=[],this.spawns=1,this.type=0,g||this.load()}getType(){return this.type}setSpawns(r){0<r&&(this.spawns=r)}getSpawns(){return this.spawns}addSpawn(){this.spawns+=1}getAmmoType(){return BULLETS_INSTANCE_DB[this.bulletData[0].id].getAmmoType()}getId(){return this.id}getUpgId(){return this.upgId}load(){let r=dbLoadWeaponMap(this.id),o=loadWeaponData(r.base);this.id=r.base,this.data=o,this.upgrade=r.upgrade,this.name=o.jpName,this.type=o.type,this.upgData=o.upgrades,this.upgLst=Object.keys(o.upgrades),this.setUpgrade(this.upgrade)}setUpgrade(r){if(0>r||10<r||!(r in this.upgLst))return void console.log("Invalid weapon upgrade number.");this.upgrade=r;let o=this.upgData[r],g=this.upgData[0];this.name=loadIfExists(o,"jpName",this.name),this.dmg=loadIfExists(o,"dmg",g.dmg),this.rel=loadIfExists(o,"reload",g.reload),this.coef=loadIfExists(o,"coef",g.coef),this.delay=loadIfExists(o,"recDelay",g.recDelay),this.dmgAttr=loadIfExists(o,"dmgAttr",g.dmgAttr),this.dmgAttrRatio=loadIfExists(o,"dmgAttrRatio",g.dmgAttrRatio),this.minRange=loadIfExists(o,"minRange",g.minRange),this.range=loadIfExists(o,"range",g.range),this.ammo=o.ammoCount,this.ammoBullet=o.ammoPerBulletID,this.bullets=o.bullets,this.upgId=o.id,this.multiBullet=!1;let h=[];if(this.ammoBullet&&(h=Object.keys(this.ammoBullet),1<h.length&&(this.multiBullet=!0)),this.type!=EWeaponTypes.SCOUT&&this.type!=EWeaponTypes.PASSIVE_SCOUT){let S={};for(let A=0;A<h.length;A++){let y=h[A],E=BULLETS_INSTANCE_DB[y];E.hash in S?S[E.hash].ammo+=this.ammoBullet[y]:S[E.hash]={id:y,ammo:this.ammoBullet[y]}}this.bulletData=[],this.bullets=[],this.ammoBullet={};let I=Object.keys(S);for(let y,A=0;A<I.length;A++)y=S[I[A]],this.bulletData.push(y),this.bullets.push(y.id),this.ammoBullet[y.id]=y.ammo}}getBullets(){let r=[];for(let o=0;o<this.bulletData.length;o++){let g=BULLETS_INSTANCE_DB[this.bulletData[o].id],h={obj:g,num:this.bulletData[o].ammo};r.push(h)}return r}isMultiBullet(){return this.multiBullet}getModifiers(){let r=[];for(let o=0;o<this.bulletLst;o++)r.push(BULLETS_INSTANCE_DB[this.bulletLst[o]].getModifiers());return r}getDamage(){return this.dmg}getDamageAttr(){return this.dmgAttr}getDamageAttrRatio(){return this.dmgAttrRatio}getCoefficient(){return this.coef}getName(){return this.name}getReload(){return this.rel}equals(r){return this.id==r.getId()&&this.upgId==r.getUpgId()}getCorrectedDamage(r){return 0.01*(this.dmg*this.coef*r)}getScaledStat(r){let o=0.01*(r[this.dmgAttr]*this.dmgAttrRatio);return 1+0.01*o}isType(r){return this.type==r}}class Bullet{constructor(r,o){this.id=r,this.mods=-1,this.type=-1,this.ammoType=-1,this.pierce=0,this.range=0,o||this.load()}load(){let r=loadBulletData(this.id);this.type=r.type,this.pierce=r.pierceCount,this.mods=r.mods,this.ammoType=r.ammo,this.range=r.range,this.hash=objectHash({type:this.type,pierce:this.pierce,mods:this.mods,ammoType:this.ammoType,range:this.range})}getAmmoType(){return this.ammoType}getRange(){return this.range}getType(){return type}canPierce(){return 0<this.pierce}getModifiers(){return MODIFIERS_DATABASE[this.mods]}equals(r){return this.hash==r.hash}}